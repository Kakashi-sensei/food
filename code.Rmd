---
title: "Untitled"
author: "Tim"
date: "2023-07-19"
output: html_document
---

# this is for the food project

## get the data ready: new variables are from the UKb data: ukb42166_2020JUN01. old variables are the same ones for the dairy project



```{Unix}
### get data10 -- get all Continuous data -- UDI from 100002 to 100025
$ cols="1,"$(seq -s, 3338 3447)
cut -d ',' -f ${cols} ukb42166_2020JUN01.csv > data10_continuous.csv
### get data11 -- get liquid data -- UDI from 100150 to 100500; from 100540 to 100550
$ cols="1,"$(seq -s, 3448 3617)","$(seq -s, 3633 3642)
cut -d ',' -f ${cols} ukb42166_2020JUN01.csv > data11_liquids.csv
### get data12 -- get bread/dessert/grain data
$ cols="1,"$(seq -s, 3758 4157)
cut -d ',' -f ${cols} ukb42166_2020JUN01.csv > data12_grain_dessert.csv
### get data13 -- get egg/meat/fish/vegetarian data
$ cols="1,"$(seq -s, 4218 4697)
cut -d ',' -f ${cols} ukb42166_2020JUN01.csv > data13_meat_vege.csv
```

# The provided code is a set of Unix commands intended to extract certain columns from a .csv file and write these columns to new .csv files. To run all of these commands at once, you can put them into a shell script, and then execute the script. Here's how:

1. Open a text editor, and paste the following code into it:

```{bash}
#!/bin/bash

# get data10 -- continuous data -- UDI from 98677 to 99461
cols="1,"$(seq -s, 3339 3448)
cut -d ',' -f ${cols} ukb42166_2020JUN01.csv > data10_continuous.csv

# get data11 -- get liquid data -- UDI from 100150 to 100500; from 100540 to 100550
cols="1,"$(seq -s, 3449 3618)","$(seq -s, 3634 3643)
cut -d ',' -f ${cols} ukb42166_2020JUN01.csv > data11_liquids.csv

# get data12 -- get bread/dessert/grain data
cols="1,"$(seq -s, 3759 4158)
cut -d ',' -f ${cols} ukb42166_2020JUN01.csv > data12_grain_dessert.csv

# get data13 -- get egg/meat/fish/vegetarian data
cols="1,"$(seq -s, 4219 4698)
cut -d ',' -f ${cols} ukb42166_2020JUN01.csv > data13_meat_vege.csv
```

2. Save this file as `extract_columns.sh` or another name of your choosing with the `.sh` extension.

3. Open a terminal window, navigate to the directory where you saved `extract_columns.sh`, and then run the following command to make the script executable:

```{bash}
chmod +x extract_columns.sh
```

4. Now, you can run the script with this command:

```{bash}
./extract_columns.sh
```

# This will execute all of the commands in the script, one after the other.

# the following codes can get all food data done in the onedrive folder
```{r}
#replace names for data11 and get data of liquids done
## 1. replace names for data11
library(dplyr)

df<-read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/data11_liquids.csv',check.names = FALSE)
df <- rename(df, "EID" = "eid")

old_names <- grep("^100150", colnames(df), value = TRUE)
new_names <- sub("^100150", "Water", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100160", colnames(df), value = TRUE)
new_names <- sub("^100160", "LowCalorie", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100170", colnames(df), value = TRUE)
new_names <- sub("^100170", "Fizzy", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100180", colnames(df), value = TRUE)
new_names <- sub("^100180", "Squash", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100190", colnames(df), value = TRUE)
new_names <- sub("^100190", "OrangeJuice", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100200", colnames(df), value = TRUE)
new_names <- sub("^100200", "GrapeJuice", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100210", colnames(df), value = TRUE)
new_names <- sub("^100210", "FruitVegeJuice", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100220", colnames(df), value = TRUE)
new_names <- sub("^100220", "FruitSmoothie", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100230", colnames(df), value = TRUE)
new_names <- sub("^100230", "DairySmoothie", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100240", colnames(df), value = TRUE)
new_names <- sub("^100240", "CoffeeConsume", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100250", colnames(df), value = TRUE)
new_names <- sub("^100250", "InstantCoffee", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100260", colnames(df), value = TRUE)
new_names <- sub("^100260", "AddMilkCoffee", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100270", colnames(df), value = TRUE)
new_names <- sub("^100270", "FilterCoffee", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100280", colnames(df), value = TRUE)
new_names <- sub("^100280", "AddMilkFilterCoffee", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100290", colnames(df), value = TRUE)
new_names <- sub("^100290", "Cappuccino", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100300", colnames(df), value = TRUE)
new_names <- sub("^100300", "Latte", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100310", colnames(df), value = TRUE)
new_names <- sub("^100310", "Espresso", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100320", colnames(df), value = TRUE)
new_names <- sub("^100320", "AddMilkEspresso", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100330", colnames(df), value = TRUE)
new_names <- sub("^100330", "OtherCoffee", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100350", colnames(df), value = TRUE)
new_names <- sub("^100350", "AddMilkOtherCoffee", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100360", colnames(df), value = TRUE)
new_names <- sub("^100360", "DecaffeinCoffee", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100370", colnames(df), value = TRUE)
new_names <- sub("^100370", "SugarAddtoCoffee", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100380", colnames(df), value = TRUE)
new_names <- sub("^100380", "ArtificialSweettoCoffee", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100390", colnames(df), value = TRUE)
new_names <- sub("^100390", "TeaConsume", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100400", colnames(df), value = TRUE)
new_names <- sub("^100400", "StandTea", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100410", colnames(df), value = TRUE)
new_names <- sub("^100410", "RooibosTea", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100420", colnames(df), value = TRUE)
new_names <- sub("^100420", "GreenTea", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100430", colnames(df), value = TRUE)
new_names <- sub("^100430", "HerbalTea", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100440", colnames(df), value = TRUE)
new_names <- sub("^100440", "OtherTea", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100460", colnames(df), value = TRUE)
new_names <- sub("^100460", "AddMilkStandTea", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100470", colnames(df), value = TRUE)
new_names <- sub("^100470", "DecaffeinTea", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100480", colnames(df), value = TRUE)
new_names <- sub("^100480", "AddMilkRooibos", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100490", colnames(df), value = TRUE)
new_names <- sub("^100490", "SugarToTea", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100500", colnames(df), value = TRUE)
new_names <- sub("^100500", "ArtificialSweetTea", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100540", colnames(df), value = TRUE)
new_names <- sub("^100540", "LowCalorieHotChocolate", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100540", colnames(df), value = TRUE)
new_names <- sub("^100540", "LowCalorieHotChocolate", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100550", colnames(df), value = TRUE)
new_names <- sub("^100550", "HotChocolate", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

## 2. get liquids data done
#get other variables
dataa<-read.csv(file='C:/Users/timothy/Documents/GWAS_data/dairy/random_effects.csv')
datab <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/dairydata_noIDV.csv')
datac<-merge(dataa,datab,by="EID")
#clean up
rm(dataa,datab)
datab<-merge(df,datac,by="EID")
rm(df)
write.csv(datab, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\food_liquids.csv",na='',row.names=FALSE)
rm(datab,new_names,old_names)


# get data12 -- grain_dessert data done
# Read the data12
df <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/data12_grain_dessert.csv', check.names = FALSE)
df <- rename(df, "EID" = "eid")

# Define a named vector where names are the old column name parts, and the values are the new ones
name_changes <- c("100940-" = "Bread_", "100950-" = "SlicedBread_", "101020-" = "Baguette_", "101090-" = "Bap_",
                  "101160-" = "Breadroll_", "101230-" = "Naanbread_", "101240-" = "Garlicbread_", 
                  "101250-" = "Crispbread_", "101260-" = "Oatcakes_", "101270-" = "Otherbread_", 
                  "101300-" = "Butteronbread_", "101310-" = "NumberofsliceswithButt_", "101350-" = "NumberbaguettewithButt_", 
                  "101390-" = "NumberbapwithButt_", "101430-" = "NumberbreadrollwithButt_", "101470-" = "NumbercrackerwithButt_",
                  "101510-" = "NumberoatcakewithButt_", "101550-" = "NumberOthbreadwithButt_", "101970-" = "DoubleCrustPastry_",
                  "101980-" = "SingleCrustPastry_", "101990-" = "Crumble_", "102000-" = "Pizza_",
                  "102010-" = "Pancake_", "102020-" = "ScotchPancake_", "102030-" = "YorkshirePudd_",
                  "102040-" = "IndiaSnack_", "102050-" = "Croissant_", "102060-" = "DanishPastry_", 
                  "102070-" = "Scone_", "102080-" = "Yogurt_IcecreamConsum_", "102090-" = "Yogurt_",
                  "102120-" = "Icecream_", "102130-" = "DessertConsum_", "102140-" = "MilkPuddin_", "102150-" = "OthMilkPuddin_",
                  "102170-" = "Soya_", "102180-" = "Fruitcake_", "102190-" = "Cake_", "102200-" = "Doughnut_", 
                  "102210-" = "Spongepuddin_", "102220-" = "Cheesecake_", "102230-" = "Othdessert_", 
                  "102250-" = "SweetsnackConsum_", "102260-" = "Chocolatebar_", "102270-" = "WhiteChocolate_", 
                  "102280-" = "MilkChocolate_", "102290-" = "DarkChocolate_", "102300-" = "ChocolateRaisin_", 
                  "102310-" = "Chocolatesweet_", "102320-" = "Dietsweet_", "102330-" = "Sweets_", 
                  "102340-" = "ChocolateCoverBiscuit_", "102350-" = "ChocolateBiscuit_", "102360-" = "SweetBiscuit_", 
                  "102370-" = "CerealBar_", "102380-" = "OthSweet_", "102400-" = "Savoury_", "102410-" = "SaltPeanut_", 
                  "102420-" = "Peanut_", "102430-" = "SaltNut_", "102440-" = "Nut_", "102450-" = "Seeds_", "102460-" = "Crisp_", 
                  "102470-" = "SavouryBiscuit_", "102480-" = "CheesyBiscuit_", "102490-" = "Olives_", "102500-" = "OthSavoury_", 
                  "102520-" = "SoupConsum_", "102530-" = "InstantSoup_", "102540-" = "CannnedSoup_", "102620-" = "HomeSoup_", 
                  "102700-" = "StarchyConsum_", "102710-" = "WhitePasta_", "102720-" = "WholemealPasta_", "102730-" = "WhiteRice_", 
                  "102740-" = "BrownRice_", "102750-" = "Sushi_", "102760-" = "Snackpot_", "102770-" = "Couscous_", "102780-" = "OthGrain_")
# Iterate over name_changes
for (old_name in names(name_changes)) {
  new_name = name_changes[old_name]
  old_names <- grep(paste0("^", old_name), colnames(df), value = TRUE)
  new_names <- sub(paste0("^", old_name), new_name, old_names)
  colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))
}
#clean up
rm(name_changes,new_name,new_names,old_name,old_names)
datab<-merge(df,datac,by="EID")
rm(df)
write.csv(datab, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\food_grain_dessert.csv",na='',row.names=FALSE)
rm(datab)

# get data13 -- meat/vege data done
# Read the data13
df <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/data13_meat_vege.csv', check.names = FALSE)
df <- rename(df, "EID" = "eid")

# Define a named vector where names are the old column name parts, and the values are the new ones
name_changes <- c("102930-" = "EggConsum_", "102940-" = "WholeEgg_", "102950-" = "Omelette_", "102960-" = "EgginSandwich_",
                  "102970-" = "ScotchEgg_", "102980-" = "OthEgg_", "103000-" = "MeatConsum_", 
                  "103010-" = "Sausage_", "103020-" = "Beef_", "103030-" = "Pork_", 
                  "103040-" = "Lamb_", "103050-" = "CrumbPoultry_", "103060-" = "Poultry_", 
                  "103070-" = "Bacon_", "103080-" = "Ham_", "103090-" = "Liver_",
                  "103100-" = "OthMeat_", "103120-" = "FatRemoveMeat_", "103130-" = "SkinRemovdPoultry_", 
                  "103140-" = "FishConsum_", "103150-" = "TinTuna_", "103160-" = "OilyFish_", 
                  "103170-" = "BreadFish_", "103180-" = "BatteredFish_", "103190-" = "WhiteFish_", 
                  "103200-" = "Prawns_", "103210-" = "LobsterCrab_", "103220-" = "Shellfish_", 
                  "103230-" = "OthFish_", "103250-" = "VegeAlter_", "103260-" = "VegeSausage_", 
                  "103270-" = "Tofu_", "103280-" = "Quorn_", "103290-" = "OthVegeAlter_", "103310-" = "SpreadConsum_", 
                  "103980-" = "NoFatCook_", "103990-" = "VegeConsum_", "104000-" = "BakeBean_", "104010-" = "Pulse_", 
                  "104020-" = "FriedPotato_", "104030-" = "BoilPotato_", "104040-" = "ButterAddPotato_", 
                  "104050-" = "MashPotato_", "104060-" = "MixVege_", "104070-" = "VegePiece_", 
                  "104080-" = "Coleslaw_", "104090-" = "SideSalad_", "104100-" = "Avocado_", "104110-" = "BroadBean_", 
                  "104120-" = "GreenBean_", "104130-" = "Beetroot_", "104140-" = "Broccoli_", "104150-" = "Butternut_", 
                  "104160-" = "Cabbage_", "104170-" = "Carrot_", "104180-" = "Cauliflower_", "104190-" = "Celery_", "104200-" = "Courgette_", 
                  "104210-" = "Cucumber_", "104220-" = "Garlic_", "104230-" = "Leek_", "104240-" = "Lettuce_", "104250-" = "Mushroom_", 
                  "104260-" = "Onion_", "104270-" = "Parsnip_", "104280-" = "Pea_", "104290-" = "Sweetpepper_", "104300-" = "Spinach_", 
                  "104310-" = "Sprouts_", "104320-" = "Sweetcorn_", "104330-" = "Sweetpotato_", "104340-" = "FreshTomato_", 
                  "104350-" = "TinTomato_", "104360-" = "Turnip_", "104370-" = "Watercress_", "104380-" = "OthVege_", 
                  "104400-" = "FruitConsum_", "104410-" = "StewedFruit_", "104420-" = "Prune_", "104430-" = "DriedFruit_", 
                  "104440-" = "MixFruit_", "104450-" = "Apple_", "104460-" = "Banana_", "104470-" = "Berry_", "104480-" = "Cherry_", 
                  "104490-" = "Grapefruit_", "104500-" = "Grape_", "104510-" = "Mango_", "104520-" = "Melon_", "104530-" = "Orange_", 
                  "104540-" = "Satsuma_", "104550-" = "Peach_", "104560-" = "Pear_", "104570-" = "Pineapple_", "104580-" = "Plum_", 
                  "104590-" = "OthFruit_", "104660-" = "AddSalt_", "104670-" = "VitaminSupplement_")

# Iterate over name_changes
for (old_name in names(name_changes)) {
  new_name = name_changes[old_name]
  old_names <- grep(paste0("^", old_name), colnames(df), value = TRUE)
  new_names <- sub(paste0("^", old_name), new_name, old_names)
  colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))
}
#clean up
rm(name_changes,new_name,new_names,old_name,old_names)
datab<-merge(df,datac,by="EID")
rm(df)
write.csv(datab, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\food_meat_vege.csv",na='',row.names=FALSE)
rm(datab)

# get data10 -- continuous data done
# Read the data10
df <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/data10_continuous.csv', check.names = FALSE)
df <- rename(df, "EID" = "eid")
# replace unusual values: time format, 0, 1, 2, and with letters(starting with A)
# Define the function to check and replace unusual values
replace_unusual <- function(x) {
  x <- as.character(x)
  
  # Replace values starting with 'A'
  x[startsWith(x, "A")] <- NA
  
  # Replace values in ISO 8601 date-time format (YYYY-MM-DDTHH:MM:SS)
  x[grepl("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$", x)] <- NA
  
  # Replace values equals to 0
  x[x %in% c("0")] <- NA
  
  return(x)
}

# Apply the function to all desired columns in the dataframe
cols <- colnames(df) # Adjust this if you want to apply it to specific columns only
df[cols] <- lapply(df[cols], replace_unusual)
#clean up
rm(cols,replace_unusual)
# Define a named vector where names are the old column name parts, and the values are the new ones
name_changes <- c("100002" = "Energy", "100003" = "Protein", "100004" = "Fat", "100005" = "Carbohydrate",
                  "100006" = "SaturateFat", "100007" = "PolyunsaturatFat", "100008" = "Sugars", 
                  "100009" = "EnglystDietaryFibre", "100011" = "Iron", "100012" = "VB6", 
                  "100013" = "VB12", "100014" = "Folate", "100015" = "VC", 
                  "100016" = "Potassium", "100017" = "Magnesium", "100018" = "Retinol",
                  "100019" = "Carotene", "100021" = "VD", "100022" = "Alcohol_continuous",
                  "100023" = "Starch", "100024" = "Calcium", "100025" = "VE")
# Iterate over name_changes
for (old_name in names(name_changes)) {
  new_name = name_changes[old_name]
  old_names <- grep(paste0("^", old_name), colnames(df), value = TRUE)
  new_names <- sub(paste0("^", old_name), new_name, old_names)
  colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))
}
#clean up
rm(name_changes,new_name,new_names,old_name,old_names)
datab<-merge(df,datac,by="EID")
rm(df)
write.csv(datab, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\food_contious.csv",na='',row.names=FALSE)
rm(list=ls())
```


```{r}
#get mean values for the continuous data
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\food_contious.csv')

# List of variables
variables <- c("Energy", "Protein", "Fat", "Carbohydrate", "SaturateFat", "PolyunsaturatFat", 
               "Sugars", "EnglystDietaryFibre", "Iron", "VB6", "VB12", "Folate", 
               "VC", "Potassium", "Magnesium", "Retinol", "Carotene", "VD", 
               "Alcohol_continuous", "Starch", "Calcium", "VE")
# Suffix for each variable
suffix <- c("_1.0", "_2.0", "_3.0", "_4.0", "_0.0")
# Loop through all variables
for (var in variables) {
  # Generate the column names for each variable
  cols <- paste0(var, suffix)
  # Check if columns exist in the dataframe
  if (all(cols %in% colnames(df))) {
    # Calculate the mean
    df[[paste0(var, "_mean")]] <- rowMeans(df[, cols], na.rm = TRUE)
  } else {
    # Print a message if columns are not found in the dataframe
    print(paste("Columns for variable", var, "not found in the dataframe."))
  }
}
#removed the column from the dataframe
# Create an empty vector to store all the column names
cols_to_remove <- c()

# Loop through all variables
for (var in variables) {
  
  # Generate the column names for each variable
  cols <- paste0(var, suffix)
  
  # Append to the list of columns to remove
  cols_to_remove <- c(cols_to_remove, cols)
}

# Remove the columns from the dataframe
df <- df[ , !(colnames(df) %in% cols_to_remove)]

write.csv(df, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_continuous.csv",na='',row.names=FALSE)
rm(list=ls())
```

```{r}
#main effects test for continuous data
library(lmerTest)
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_continuous.csv')
# Fit the model
df$APOE_all <- as.factor(df$APOE_all)
df$T40_Gcar <- as.factor(df$T40_Gcar)
df$family_history_AD <- as.factor(df$family_history_AD)
df$Sex <- as.factor(df$Sex)
df$AlcoholY08 <- as.factor(df$AlcoholY08)
df$SmokingY08 <- as.factor(df$SmokingY08)
df$Assessment_0 <- as.factor(df$Assessment_0)
df$EID <- as.factor(df$EID)
results <- data.frame()
# List of variables to test
test_vars <- c("Energy_mean", "Protein_mean", "Fat_mean", "Carbohydrate_mean", "SaturateFat_mean", 
               "PolyunsaturatFat_mean", "Sugars_mean", "EnglystDietaryFibre_mean", "Iron_mean", "VB6_mean", 
               "VB12_mean", "Folate_mean", "VC_mean", "Potassium_mean", "Magnesium_mean", "Retinol_mean", 
               "Carotene_mean", "VD_mean", "Alcohol_continuous_mean", "Starch_mean", "Calcium_mean", "VE_mean")

dependent_vars <- c("rsfMRI_Component1", "rsfMRI_Component5", "rsfMRI_Component7", "rsfMRI_Component9", 
                    "rsfMRI_Component10", "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component20")

# Double loop through each dependent and test variable and fit the model
for (dep_var in dependent_vars) {
  for (test_var in test_vars) {
  
    # Construct the formula
    formula <- as.formula(paste(dep_var, "~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + 
                               BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend +", test_var, "+ 
                               (1 | Assessment_0)"))
  
    # Fit the model
    model <- lmer(formula, data = df, REML=FALSE)
    
   # Get the summary
    model_summary <- summary(model)
    
    # Extract the results for the test variable
    estimate <- model_summary$coefficients[test_var, "Estimate"]
    std_error <- model_summary$coefficients[test_var, "Std. Error"]
    p_value <- model_summary$coefficients[test_var, "Pr(>|t|)"]
    
    # Add the results to the data frame
    results <- rbind(results, data.frame(Dependent_Variable = dep_var,
                                         Test_Variable = test_var,
                                         Estimate = estimate,
                                         Std_Error = std_error,
                                         p_value = p_value))
  }
}
write.csv(results, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\output\\maineffect_continuous.csv",na='',row.names=FALSE)
rm(list=ls())
```

```{r}
#interaction test for continuous data
library(lmerTest)
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_continuous.csv')

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID")
for (var in factor_vars) {
  df[[var]] <- as.factor(df[[var]])
}
rm(factor_vars,var)

# Scale all continuous variables
scale_vars <- c("Energy_mean", "Protein_mean", "Fat_mean", "Carbohydrate_mean", "SaturateFat_mean", 
               "PolyunsaturatFat_mean", "Sugars_mean", "EnglystDietaryFibre_mean", "Iron_mean", "VB6_mean", 
               "VB12_mean", "Folate_mean", "VC_mean", "Potassium_mean", "Magnesium_mean", "Retinol_mean", 
               "Carotene_mean", "VD_mean", "Alcohol_continuous_mean", "Starch_mean", "Calcium_mean", "VE_mean", 
               "rsfMRI_Component1", "rsfMRI_Component5", "rsfMRI_Component7", "rsfMRI_Component9", "rsfMRI_Component10", 
               "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component20", "Age_Baseline", "BMI_Y08andY12andY14_mean")

for (var in scale_vars) {
  df[[var]] <- scale(df[[var]])
}
rm(scale_vars, var)

# Define the dependent variables
dependent_vars <- c("rsfMRI_Component1", "rsfMRI_Component5", "rsfMRI_Component7", "rsfMRI_Component9", 
                    "rsfMRI_Component10", "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component20")

# List of variables to test
test_vars <- c("Energy_mean", "Protein_mean", "Fat_mean", "Carbohydrate_mean", "SaturateFat_mean", 
               "PolyunsaturatFat_mean", "Sugars_mean", "EnglystDietaryFibre_mean", "Iron_mean", "VB6_mean", 
               "VB12_mean", "Folate_mean", "VC_mean", "Potassium_mean", "Magnesium_mean", "Retinol_mean", 
               "Carotene_mean", "VD_mean", "Alcohol_continuous_mean", "Starch_mean", "Calcium_mean", "VE_mean")

# List of factors
factor_vars <- c("APOE_all", "T40_Gcar", "family_history_AD")

# Initialize a results data frame
results <- data.frame()

# Loop over each dependent variable
for(factor_var in factor_vars) {
 for (dep_var in dependent_vars) {
  for (test_var in test_vars) {
      
    # Construct the formula
    formula <- as.formula(paste(dep_var, "~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + 
                               BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend +", factor_var, ":", test_var, "+ 
                               (1 | Assessment_0)"))
  
    # Fit the model
    model <- lmer(formula, data = df, REML=FALSE)

    # Get the summary
    model_summary <- summary(model)
   
    # Extract the results for the interaction term
    interaction_term <- paste(factor_var, test_var, sep=":")
    estimate <- model_summary$coefficients[interaction_term, "Estimate"]
    std_error <- model_summary$coefficients[interaction_term, "Std. Error"]
    p_value <- model_summary$coefficients[interaction_term, "Pr(>|t|)"]

    # Add the results to the data frame
    results <- rbind(results, data.frame(Dependent_Variable = dep_var,
                                         Test_Variable = test_var,
                                         Estimate = estimate,
                                         Std_Error = std_error,
                                         P_Value = p_value))
    }
  }
}
write.csv(results, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\output\\interactions_continuous.csv",na='',row.names=FALSE)
rm(list=ls())
```


```{r}
#work on food_liquids
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_liquids.csv')
# remove invalid values
# wanted variables
variables <- c("Water_1.0", "Water_2.0", "Water_3.0", "Water_4.0", "Water_0.0",
               "LowCalorie_1.0", "LowCalorie_2.0", "LowCalorie_3.0", "LowCalorie_4.0", "LowCalorie_0.0",
               "Fizzy_1.0", "Fizzy_2.0", "Fizzy_3.0", "Fizzy_4.0", "Fizzy_0.0",
               "Squash_1.0", "Squash_2.0", "Squash_3.0", "Squash_4.0", "Squash_0.0",
               "OrangeJuice_1.0", "OrangeJuice_2.0", "OrangeJuice_3.0", "OrangeJuice_4.0", "OrangeJuice_0.0",
               "GrapeJuice_1.0", "GrapeJuice_2.0", "GrapeJuice_3.0", "GrapeJuice_4.0", "GrapeJuice_0.0",
               "FruitVegeJuice_1.0", "FruitVegeJuice_2.0", "FruitVegeJuice_3.0", "FruitVegeJuice_4.0", "FruitVegeJuice_0.0",
               "FruitSmoothie_1.0", "FruitSmoothie_2.0", "FruitSmoothie_3.0", "FruitSmoothie_4.0", "FruitSmoothie_0.0",
               "DairySmoothie_1.0", "DairySmoothie_2.0", "DairySmoothie_3.0", "DairySmoothie_4.0", "DairySmoothie_0.0", 
               "InstantCoffee_1.0",	"InstantCoffee_2.0", "InstantCoffee_3.0", "InstantCoffee_4.0", "InstantCoffee_0.0",
               "FilterCoffee_1.0", "FilterCoffee_2.0", "FilterCoffee_3.0", "FilterCoffee_4.0", "FilterCoffee_0.0", 
               "Cappuccino_1.0", "Cappuccino_2.0", "Cappuccino_3.0", "Cappuccino_4.0", "Cappuccino_0.0", 
               "Latte_1.0", "Latte_2.0", "Latte_3.0", "Latte_4.0", "Latte_0.0", 
               "Espresso_1.0", "Espresso_2.0", "Espresso_3.0", "Espresso_4.0", "Espresso_0.0", 
               "OtherCoffee_1.0", "OtherCoffee_2.0", "OtherCoffee_3.0", "OtherCoffee_4.0", "OtherCoffee_0.0", 
               "LCalorieHotChocolate_1.0", "LCalorieHotChocolate_2.0", "LCalorieHotChocolate_3.0", 
               "LCalorieHotChocolate_4.0", "LCalorieHotChocolate_0.0", 
               "HChocolate_1.0", "HChocolate_2.0", "HChocolate_3.0", "HChocolate_4.0", "HChocolate_0.0")
# consumption variables (can be only 0 or 1)
cvariables <- c("CoffeeConsume_1.0", "CoffeeConsume_2.0",	"CoffeeConsume_3.0",	"CoffeeConsume_4.0",	"CoffeeConsume_0.0", "TeaConsume_1.0",	"TeaConsume_2.0",	"TeaConsume_3.0",	"TeaConsume_4.0",	"TeaConsume_0.0")
# invalid values are with decimal (replace all non-integer (decimal) values in the specified columns of the df data frame with NA)
df[, variables] <- lapply(df[, variables], function(x) ifelse(x == floor(x), x, NA))
# define valid values
valid_jvalues <- c(0, 1, 2, 3, 4, 5, 555, 600)
valid_cvalues <- c(0, 1)
# only keep valid values for wanted variables
df[, variables] <- lapply(df[, variables], function(x) ifelse(x %in% valid_jvalues, x, NA))
# only keep valid values for consumption variables
df[, cvariables] <- lapply(df[, cvariables], function(x) ifelse(x %in% valid_cvalues, x, NA))
# remove unwanted variables
library(dplyr)
# variables to remove
variables_to_remove <- c("AddMilkFilterCoffee_1.0", "AddMilkFilterCoffee_2.0", "AddMilkFilterCoffee_3.0", 
                         "AddMilkFilterCoffee_4.0", "AddMilkFilterCoffee_0.0", "AddMilkCoffee_1.0", 
                         "AddMilkCoffee_2.0", "AddMilkCoffee_3.0", "AddMilkCoffee_4.0", "AddMilkCoffee_0.0",
                         "SugarAddtoCoffee_1.0", "SugarAddtoCoffee_2.0", "SugarAddtoCoffee_3.0", 
                         "SugarAddtoCoffee_4.0", "SugarAddtoCoffee_0.0", "ArtificialSweettoCoffee_1.0", "ArtificialSweettoCoffee_2.0",
                         "ArtificialSweettoCoffee_3.0", "ArtificialSweettoCoffee_4.0", "ArtificialSweettoCoffee_0.0", 
                         "AddMilkStandTea_1.0", "AddMilkStandTea_2.0", "AddMilkStandTea_3.0", "AddMilkStandTea_4.0", 
                         "AddMilkStandTea_0.0", "DecaffeinTea_1.0", "DecaffeinTea_2.0", "DecaffeinTea_3.0", 
                         "DecaffeinTea_4.0", "DecaffeinTea_0.0", "AddMilkRooibos_1.0", "AddMilkRooibos_2.0", 
                         "AddMilkRooibos_3.0", "AddMilkRooibos_4.0", "AddMilkRooibos_0.0", "SugarToTea_1.0", 
                         "SugarToTea_2.0", "SugarToTea_3.0", "SugarToTea_4.0", "SugarToTea_0.0", "ArtificialSweetTea_1.0", 
                         "ArtificialSweetTea_2.0", "ArtificialSweetTea_3.0", "ArtificialSweetTea_4.0", "ArtificialSweetTea_0.0")
df <- df %>% select(-one_of(variables_to_remove))
# replace "555" and "600"
df[, variables] <- lapply(df[, variables], function(x) { 
    x <- ifelse(x == 555, 0.5, x) 
    x <- ifelse(x == 600, 6, x)
    x
})
rm(cvariables, valid_cvalues, valid_jvalues, variables, variables_to_remove)
# List of variables
variables <- c("Water", "LowCalorie", "Fizzy", "Squash", "OrangeJuice", "GrapeJuice", "FruitVegeJuice", "FruitSmoothie", "DairySmoothie", "InstantCoffee", "FilterCoffee", "Cappuccino", "Latte", "Espresso", "OtherCoffee", "LCalorieHotChocolate", "HChocolate")
# Suffix for each variable
suffix <- c("_1.0", "_2.0", "_3.0", "_4.0", "_0.0")
# Loop through all variables
for (var in variables) {
  # Generate the column names for each variable
  cols <- paste0(var, suffix)
  # Check if columns exist in the dataframe
  if (all(cols %in% colnames(df))) {
    # Calculate the mean
    df[[paste0(var, "_mean")]] <- rowMeans(df[, cols], na.rm = TRUE)
  }
}
rm(cols, suffix, var, variables)

# merge juice and coffee
# 1. merge juice:
juice_vars <- c("Fizzy", "Squash", "OrangeJuice", "GrapeJuice", 
                "FruitVegeJuice", "FruitSmoothie", "DairySmoothie")
suffixes <- c("1.0", "2.0", "3.0", "4.0", "0.0")

# calculate juice_* variables
for(suffix in suffixes) {
  columns <- paste(juice_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("juice", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of juice
df$juice_mean <- rowMeans(df[, paste("juice", suffixes, sep="_")], na.rm = TRUE)

# Remove juice_* columns
df <- df[ , !(names(df) %in% paste("juice", suffixes, sep="_"))]
rm(columns, juice_vars, new_column, suffix)

# 2. merge coffee:
coffee_vars <- c("InstantCoffee", "FilterCoffee", "Cappuccino", "Latte", 
                "Espresso", "OtherCoffee")
# calculate coffee_* variables
for(suffix in suffixes) {
  columns <- paste(coffee_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("coffee", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of coffee
df$coffee_mean <- rowMeans(df[, paste("coffee", suffixes, sep="_")], na.rm = TRUE)

# Remove coffee_* columns
df <- df[ , !(names(df) %in% paste("coffee", suffixes, sep="_"))]

write.csv(df, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_liquids1.csv",na='',row.names=FALSE)
rm(list=ls())
```

```{r}
# get the grain_dessert data ready to go
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\food_grain_dessert.csv')
# remove invalid values
# wanted variables
bread_variables <- c("SlicedBread_1.0", "SlicedBread_2.0", "SlicedBread_3.0", "SlicedBread_4.0", "SlicedBread_0.0",
                     "Baguette_1.0", "Baguette_2.0", "Baguette_3.0", "Baguette_4.0", "Baguette_0.0", 
                     "Bap_1.0", "Bap_2.0", "Bap_3.0", "Bap_4.0", "Bap_0.0", "Breadroll_1.0", "Breadroll_2.0", 
                     "Breadroll_3.0", "Breadroll_4.0", "Breadroll_0.0", "Naanbread_1.0", "Naanbread_2.0", 
                     "Naanbread_3.0", "Naanbread_4.0", "Naanbread_0.0", "Garlicbread_1.0", "Garlicbread_2.0", 
                     "Garlicbread_3.0", "Garlicbread_4.0", "Garlicbread_0.0", "Crispbread_1.0", "Crispbread_2.0", 
                     "Crispbread_3.0", "Crispbread_4.0", "Crispbread_0.0", "Oatcakes_1.0", "Oatcakes_2.0", 
                     "Oatcakes_3.0", "Oatcakes_4.0", "Oatcakes_0.0", "Otherbread_1.0", "Otherbread_2.0", 
                     "Otherbread_3.0", "Otherbread_4.0", "Otherbread_0.0")

nubread_variables <- c("NumberofsliceswithButt_1.0", "NumberofsliceswithButt_2.0", "NumberofsliceswithButt_3.0", 
                       "NumberofsliceswithButt_4.0", "NumberofsliceswithButt_0.0", "NumberbaguettewithButt_1.0", 
                       "NumberbaguettewithButt_2.0", "NumberbaguettewithButt_3.0", "NumberbaguettewithButt_4.0", 
                       "NumberbaguettewithButt_0.0", "NumberbapwithButt_1.0", "NumberbapwithButt_2.0", 
                       "NumberbapwithButt_3.0", "NumberbapwithButt_4.0", "NumberbapwithButt_0.0", 
                       "NumberbreadrollwithButt_1.0", "NumberbreadrollwithButt_2.0", "NumberbreadrollwithButt_3.0", 
                       "NumberbreadrollwithButt_4.0", "NumberbreadrollwithButt_0.0", "NumbercrackerwithButt_1.0", 
                       "NumbercrackerwithButt_2.0", "NumbercrackerwithButt_3.0", "NumbercrackerwithButt_4.0", 
                       "NumbercrackerwithButt_0.0", "NumberoatcakewithButt_1.0", "NumberoatcakewithButt_2.0", 
                       "NumberoatcakewithButt_3.0", "NumberoatcakewithButt_4.0", "NumberoatcakewithButt_0.0", 
                       "NumberOthbreadwithButt_1.0", "NumberOthbreadwithButt_2.0", "NumberOthbreadwithButt_3.0", 
                       "NumberOthbreadwithButt_4.0", "NumberOthbreadwithButt_0.0")

pie_variables <- c("DoubleCrustPastry_1.0", "DoubleCrustPastry_2.0", "DoubleCrustPastry_3.0", "DoubleCrustPastry_4.0", "DoubleCrustPastry_0.0",
                   "SingleCrustPastry_1.0", "SingleCrustPastry_2.0", "SingleCrustPastry_3.0", "SingleCrustPastry_4.0", "SingleCrustPastry_0.0",
                   "Crumble_1.0", "Crumble_2.0", "Crumble_3.0", "Crumble_4.0", "Crumble_0.0", 
                   "Pizza_1.0", "Pizza_2.0", "Pizza_3.0", "Pizza_4.0", "Pizza_0.0",
                   "Pancake_1.0","Pancake_2.0","Pancake_3.0","Pancake_4.0","Pancake_0.0",
                   "ScotchPancake_1.0","ScotchPancake_2.0","ScotchPancake_3.0","ScotchPancake_4.0","ScotchPancake_0.0",
                   "YorkshirePudd_1.0","YorkshirePudd_2.0","YorkshirePudd_3.0","YorkshirePudd_4.0","YorkshirePudd_0.0",
                   "IndiaSnack_1.0","IndiaSnack_2.0","IndiaSnack_3.0","IndiaSnack_4.0","IndiaSnack_0.0",
                   "Croissant_1.0","Croissant_2.0","Croissant_3.0","Croissant_4.0","Croissant_0.0",
                   "DanishPastry_1.0","DanishPastry_2.0","DanishPastry_3.0","DanishPastry_4.0","DanishPastry_0.0",
                   "Scone_1.0","Scone_2.0","Scone_3.0","Scone_4.0","Scone_0.0")

dessert_variables <- c("Yogurt_1.0", "Yogurt_2.0", "Yogurt_3.0", "Yogurt_4.0", "Yogurt_0.0", 
                       "Icecream_1.0", "Icecream_2.0", "Icecream_3.0", "Icecream_4.0", "Icecream_0.0", 
                       "OthMilkPuddin_1.0", "OthMilkPuddin_2.0", "OthMilkPuddin_3.0", "OthMilkPuddin_4.0", "OthMilkPuddin_0.0", 
                       "Soya_1.0", "Soya_2.0", "Soya_3.0", "Soya_4.0", "Soya_0.0", 
                       "Fruitcake_1.0", "Fruitcake_2.0", "Fruitcake_3.0", "Fruitcake_4.0", "Fruitcake_0.0", 
                       "Cake_1.0", "Cake_2.0", "Cake_3.0", "Cake_4.0", "Cake_0.0", 
                       "Doughnut_1.0", "Doughnut_2.0", "Doughnut_3.0", "Doughnut_4.0", "Doughnut_0.0", 
                       "Spongepuddin_1.0", "Spongepuddin_2.0", "Spongepuddin_3.0", "Spongepuddin_4.0", "Spongepuddin_0.0", 
                       "Cheesecake_1.0", "Cheesecake_2.0", "Cheesecake_3.0", "Cheesecake_4.0", "Cheesecake_0.0", 
                       "Othdessert_1.0", "Othdessert_2.0", "Othdessert_3.0", "Othdessert_4.0", "Othdessert_0.0")

sweet_variables <- c("Chocolatebar_1.0", "Chocolatebar_2.0", "Chocolatebar_3.0", "Chocolatebar_4.0", "Chocolatebar_0.0", 
                     "WhiteChocolate_1.0", "WhiteChocolate_2.0", "WhiteChocolate_3.0", "WhiteChocolate_4.0", "WhiteChocolate_0.0", 
                     "MilkChocolate_1.0", "MilkChocolate_2.0", "MilkChocolate_3.0", "MilkChocolate_4.0", "MilkChocolate_0.0", 
                     "DarkChocolate_1.0", "DarkChocolate_2.0", "DarkChocolate_3.0", "DarkChocolate_4.0", "DarkChocolate_0.0", 
                     "ChocolateRaisin_1.0", "ChocolateRaisin_2.0", "ChocolateRaisin_3.0", "ChocolateRaisin_4.0", "ChocolateRaisin_0.0",
                     "Chocolatesweet_1.0", "Chocolatesweet_2.0", "Chocolatesweet_3.0", "Chocolatesweet_4.0", "Chocolatesweet_0.0", 
                     "Dietsweet_1.0", "Dietsweet_2.0", "Dietsweet_3.0", "Dietsweet_4.0", "Dietsweet_0.0", 
                     "Sweets_1.0", "Sweets_2.0", "Sweets_3.0", "Sweets_4.0", "Sweets_0.0", 
                     "ChocolateCoverBiscuit_1.0", "ChocolateCoverBiscuit_2.0", "ChocolateCoverBiscuit_3.0", "ChocolateCoverBiscuit_4.0", "ChocolateCoverBiscuit_0.0", 
                     "ChocolateBiscuit_1.0", "ChocolateBiscuit_2.0", "ChocolateBiscuit_3.0", "ChocolateBiscuit_4.0", "ChocolateBiscuit_0.0",
                     "SweetBiscuit_1.0", "SweetBiscuit_2.0", "SweetBiscuit_3.0", "SweetBiscuit_4.0", "SweetBiscuit_0.0", 
                     "CerealBar_1.0", "CerealBar_2.0", "CerealBar_3.0", "CerealBar_4.0", "CerealBar_0.0", 
                     "OthSweet_1.0", "OthSweet_2.0", "OthSweet_3.0", "OthSweet_4.0", "OthSweet_0.0")

savoury_variables <- c("SaltPeanut_1.0", "SaltPeanut_2.0", "SaltPeanut_3.0", "SaltPeanut_4.0", "SaltPeanut_0.0", 
                       "Peanut_1.0", "Peanut_2.0", "Peanut_3.0", "Peanut_4.0", "Peanut_0.0", 
                       "SaltNut_1.0", "SaltNut_2.0", "SaltNut_3.0", "SaltNut_4.0", "SaltNut_0.0", 
                       "Nut_1.0", "Nut_2.0", "Nut_3.0", "Nut_4.0", "Nut_0.0", 
                       "Seeds_1.0", "Seeds_2.0", "Seeds_3.0", "Seeds_4.0", "Seeds_0.0", 
                       "Crisp_1.0", "Crisp_2.0", "Crisp_3.0", "Crisp_4.0", "Crisp_0.0", 
                       "SavouryBiscuit_1.0", "SavouryBiscuit_2.0", "SavouryBiscuit_3.0", "SavouryBiscuit_4.0", "SavouryBiscuit_0.0", 
                       "CheesyBiscuit_1.0", "CheesyBiscuit_2.0", "CheesyBiscuit_3.0", "CheesyBiscuit_4.0", "CheesyBiscuit_0.0", 
                       "Olives_1.0", "Olives_2.0", "Olives_3.0", "Olives_4.0", "Olives_0.0", 
                       "OthSavoury_1.0", "OthSavoury_2.0", "OthSavoury_3.0", "OthSavoury_4.0", "OthSavoury_0.0")

soup_variables <- c("InstantSoup_1.0", "InstantSoup_2.0", "InstantSoup_3.0", "InstantSoup_4.0", "InstantSoup_0.0", 
                    "CannnedSoup_1.0", "CannnedSoup_2.0", "CannnedSoup_3.0", "CannnedSoup_4.0", "CannnedSoup_0.0", 
                    "HomeSoup_1.0", "HomeSoup_2.0", "HomeSoup_3.0", "HomeSoup_4.0", "HomeSoup_0.0")

starchy_variables <- c("WhitePasta_1.0", "WhitePasta_2.0", "WhitePasta_3.0", "WhitePasta_4.0", "WhitePasta_0.0", 
                       "WholemealPasta_1.0", "WholemealPasta_2.0", "WholemealPasta_3.0", "WholemealPasta_4.0", "WholemealPasta_0.0", 
                       "WhiteRice_1.0", "WhiteRice_2.0", "WhiteRice_3.0", "WhiteRice_4.0", "WhiteRice_0.0", 
                       "BrownRice_1.0", "BrownRice_2.0", "BrownRice_3.0", "BrownRice_4.0", "BrownRice_0.0", 
                       "Sushi_1.0", "Sushi_2.0", "Sushi_3.0", "Sushi_4.0", "Sushi_0.0", 
                       "Snackpot_1.0", "Snackpot_2.0", "Snackpot_3.0", "Snackpot_4.0", "Snackpot_0.0", 
                       "Couscous_1.0", "Couscous_2.0", "Couscous_3.0", "Couscous_4.0", "Couscous_0.0", 
                       "OthGrain_1.0", "OthGrain_2.0", "OthGrain_3.0", "OthGrain_4.0", "OthGrain_0.0")
# consumption variables (can be only 0 or 1)
cvariables <- c("Bread_1.0", "Bread_2.0", "Bread_3.0", "Bread_4.0", "Bread_0.0", "Butteronbread_1.0", "Butteronbread_2.0", "Butteronbread_3.0", "Butteronbread_4.0", "Butteronbread_0.0", "Yogurt_IcecreamConsum_1.0", "Yogurt_IcecreamConsum_2.0", "Yogurt_IcecreamConsum_3.0", "Yogurt_IcecreamConsum_4.0", "Yogurt_IcecreamConsum_0.0", "DessertConsum_1.0", "DessertConsum_2.0", "DessertConsum_3.0", "DessertConsum_4.0", "DessertConsum_0.0", "SweetsnackConsum_1.0", "SweetsnackConsum_2.0", "SweetsnackConsum_3.0", "SweetsnackConsum_4.0", "SweetsnackConsum_0.0", "Savoury_1.0", "Savoury_2.0", "Savoury_3.0", "Savoury_4.0", "Savoury_0.0", "SoupConsum_1.0", "SoupConsum_2.0", "SoupConsum_3.0", "SoupConsum_4.0", "SoupConsum_0.0", "StarchyConsum_1.0", "StarchyConsum_2.0", "StarchyConsum_3.0", "StarchyConsum_4.0", "StarchyConsum_0.0")
# define valid values
valid_bread_values <- c(1, 2, 3, 4, 5, 600, 555)
valid_pie_values <- c(1, 2, 3, 400, 555)
valid_dessert_values <- c(1, 2, 300, 555)
valid_sweet_values <- c(1, 2, 3, 4, 500, 444, 555)
valid_savoury_values <- c(1, 2, 300, 555)
valid_soup_values <- c(1, 2, 3, 400, 555)
valid_starchy_values <- c(1,200, 555)
valid_cvalues <- c(0, 1)
# only keep valid values for wanted variables
df[, bread_variables] <- lapply(df[, bread_variables], function(x) ifelse(x %in% valid_bread_values, x, NA))
df[, nubread_variables] <- lapply(df[, nubread_variables], function(x) ifelse(x %in% valid_bread_values, x, NA))
df[, pie_variables] <- lapply(df[, pie_variables], function(x) ifelse(x %in% valid_pie_values, x, NA))
df[, dessert_variables] <- lapply(df[, dessert_variables], function(x) ifelse(x %in% valid_dessert_values, x, NA))
df[, sweet_variables] <- lapply(df[, sweet_variables], function(x) ifelse(x %in% valid_sweet_values, x, NA))
df[, savoury_variables] <- lapply(df[, savoury_variables], function(x) ifelse(x %in% valid_savoury_values, x, NA))
df[, soup_variables] <- lapply(df[, soup_variables], function(x) ifelse(x %in% valid_soup_values, x, NA))
df[, starchy_variables] <- lapply(df[, starchy_variables], function(x) ifelse(x %in% valid_starchy_values, x, NA))
df[, cvariables] <- lapply(df[, cvariables], function(x) ifelse(x %in% valid_cvalues, x, NA))
# replace values
df[, bread_variables] <- lapply(df[, bread_variables], function(x) { 
    x <- ifelse(x == 555, 0.5, x) 
    x <- ifelse(x == 600, 6, x)
    x
})
df[, nubread_variables] <- lapply(df[, nubread_variables], function(x) { 
    x <- ifelse(x == 555, 0.5, x) 
    x <- ifelse(x == 600, 6, x)
    x
})
df[, pie_variables] <- lapply(df[, pie_variables], function(x) { 
    x <- ifelse(x == 555, 0.5, x) 
    x <- ifelse(x == 400, 4, x)
    x
})
df[, dessert_variables] <- lapply(df[, dessert_variables], function(x) { 
    x <- ifelse(x == 555, 0.5, x) 
    x <- ifelse(x == 300, 3, x)
    x
})
df[, sweet_variables] <- lapply(df[, sweet_variables], function(x) { 
    x <- ifelse(x == 555, 0.5, x) 
    x <- ifelse(x == 500, 5, x)
    x <- ifelse(x == 444, 0.25, x)
    x
})
df[, savoury_variables] <- lapply(df[, savoury_variables], function(x) { 
    x <- ifelse(x == 555, 0.5, x) 
    x <- ifelse(x == 300, 3, x)
    x
})
df[, soup_variables] <- lapply(df[, soup_variables], function(x) { 
    x <- ifelse(x == 555, 0.5, x) 
    x <- ifelse(x == 400, 4, x)
    x
})
df[, starchy_variables] <- lapply(df[, starchy_variables], function(x) { 
    x <- ifelse(x == 555, 0.5, x) 
    x <- ifelse(x == 200, 2, x)
    x
})

rm(valid_bread_values, valid_pie_values,valid_dessert_values, valid_sweet_values, valid_savoury_values, valid_soup_values, valid_starchy_values, valid_cvalues)

# List of variables
variables <- c("SlicedBread", "Baguette", "Bap", "Breadroll", "Naanbread", "Garlicbread", "Crispbread", "Oatcakes", "Otherbread", "NumberofsliceswithButt", "NumberbaguettewithButt", "NumberbapwithButt", "NumberbreadrollwithButt", "NumbercrackerwithButt", "NumberoatcakewithButt", "NumberOthbreadwithButt", "DoubleCrustPastry", "SingleCrustPastry", "Crumble", "Pizza", "Pancake", "ScotchPancake", "YorkshirePudd", "IndiaSnack", "Croissant", "DanishPastry", "Scone", "Yogurt", "Icecream", "MilkPuddin", "OthMilkPuddin", "Soya", "Fruitcake", "Cake", "Doughnut", "Spongepuddin", "Cheesecake", "Othdessert", "Chocolatebar", "WhiteChocolate", "MilkChocolate", "DarkChocolate", "ChocolateRaisin", "Chocolatesweet", "Dietsweet", "Sweets", "ChocolateCoverBiscuit", "ChocolateBiscuit", "SweetBiscuit", "CerealBar", "OthSweet", "SaltPeanut", "Peanut", "SaltNut", "Nut", "Seeds", "Crisp", "SavouryBiscuit", "CheesyBiscuit", "Olives", "OthSavoury", "InstantSoup", "CannnedSoup", "HomeSoup", "WhitePasta", "WholemealPasta", "WhiteRice", "BrownRice", "Sushi Snackpot", "Couscous", "OthGrain")

# Suffix for each variable
suffix <- c("_1.0", "_2.0", "_3.0", "_4.0", "_0.0")
# Loop through all variables
for (var in variables) {
  # Generate the column names for each variable
  cols <- paste0(var, suffix)
  # Check if columns exist in the dataframe
  if (all(cols %in% colnames(df))) {
    # Calculate the mean
    df[[paste0(var, "_mean")]] <- rowMeans(df[, cols], na.rm = TRUE)
  }
}
rm(cols, suffix, var, variables, bread_variables, nubread_variables, pie_variables, dessert_variables, sweet_variables, savoury_variables, soup_variables, starchy_variables, cvariables)

# merge variables
# 1. merge bread:
bread_vars <- c("SlicedBread", "Baguette", "Bap", "Breadroll", "Naanbread", "Garlicbread", "Crispbread", "Oatcakes", "Otherbread")
suffixes <- c("1.0", "2.0", "3.0", "4.0", "0.0")

# calculate bread_* variables
for(suffix in suffixes) {
  columns <- paste(bread_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("bread", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of juice
df$bread_mean <- rowMeans(df[, paste("bread", suffixes, sep="_")], na.rm = TRUE)

# Remove bread_* columns
df <- df[ , !(names(df) %in% paste("bread", suffixes, sep="_"))]
rm(columns, bread_vars, new_column, suffix)

# 2. merge bread with butt:
breadWithButt_vars <- c("NumberofsliceswithButt", "NumberbaguettewithButt", "NumberbapwithButt", "NumberbreadrollwithButt", "NumbercrackerwithButt", "NumberoatcakewithButt", "NumberOthbreadwithButt")
# calculate breadWithButt_* variables
for(suffix in suffixes) {
  columns <- paste(breadWithButt_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("breadWithButt", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of breadWithButt
df$breadWithButt_mean <- rowMeans(df[, paste("breadWithButt", suffixes, sep="_")], na.rm = TRUE)

# Remove breadWithButt_* columns
df <- df[ , !(names(df) %in% paste("breadWithButt", suffixes, sep="_"))]
rm(columns, breadWithButt_vars, new_column, suffix)

# 3. merge all bread:
breadall_vars <- c("SlicedBread", "Baguette", "Bap", "Breadroll", "Naanbread", "Garlicbread", "Crispbread", "Oatcakes", "Otherbread", "NumberofsliceswithButt", "NumberbaguettewithButt", "NumberbapwithButt", "NumberbreadrollwithButt", "NumbercrackerwithButt", "NumberoatcakewithButt", "NumberOthbreadwithButt")
# calculate breadall_* variables
for(suffix in suffixes) {
  columns <- paste(breadall_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("breadall", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of breadall
df$breadall_mean <- rowMeans(df[, paste("breadall", suffixes, sep="_")], na.rm = TRUE)

# Remove breadall_* columns
df <- df[ , !(names(df) %in% paste("breadall", suffixes, sep="_"))]
rm(columns, breadall_vars, new_column, suffix)

# 4. merge pie:
pie_vars <- c("DoubleCrustPastry", "SingleCrustPastry", "Crumble", "Pizza", "Pancake", "ScotchPancake", "YorkshirePudd", "IndiaSnack", "Croissant", "DanishPastry", "Scone")
# calculate pie_* variables
for(suffix in suffixes) {
  columns <- paste(pie_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("pie", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of pie
df$pie_mean <- rowMeans(df[, paste("pie", suffixes, sep="_")], na.rm = TRUE)

# Remove pie_* columns
df <- df[ , !(names(df) %in% paste("pie", suffixes, sep="_"))]
rm(columns, pie_vars, new_column, suffix)

# 5. merge dessert:
dessert_vars <- c("Yogurt", "Icecream", "MilkPuddin", "OthMilkPuddin", "Soya", "Fruitcake", "Cake", "Doughnut", "Spongepuddin", "Cheesecake", "Othdessert")
# calculate dessert_* variables
for(suffix in suffixes) {
  columns <- paste(dessert_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("dessert", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of dessert
df$dessert_mean <- rowMeans(df[, paste("dessert", suffixes, sep="_")], na.rm = TRUE)

# Remove dessert_* columns
df <- df[ , !(names(df) %in% paste("dessert", suffixes, sep="_"))]
rm(columns, dessert_vars, new_column, suffix)

# 6. merge sweet:
sweet_vars <- c("Chocolatebar", "WhiteChocolate", "MilkChocolate", "DarkChocolate", "ChocolateRaisin", "Chocolatesweet", "Dietsweet", "Sweets", "ChocolateCoverBiscuit", "ChocolateBiscuit", "SweetBiscuit", "CerealBar", "OthSweet")
# calculate sweet_* variables
for(suffix in suffixes) {
  columns <- paste(sweet_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("sweet", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of sweet
df$sweet_mean <- rowMeans(df[, paste("sweet", suffixes, sep="_")], na.rm = TRUE)

# Remove sweet_* columns
df <- df[ , !(names(df) %in% paste("sweet", suffixes, sep="_"))]
rm(columns, sweet_vars, new_column, suffix)

# 7. merge savoury:
savoury_vars <- c("SaltPeanut", "Peanut", "SaltNut", "Nut", "Seeds", "Crisp", "SavouryBiscuit", "CheesyBiscuit", "Olives", "OthSavoury")
# calculate savoury_* variables
for(suffix in suffixes) {
  columns <- paste(savoury_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("savoury", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of savoury
df$savoury_mean <- rowMeans(df[, paste("savoury", suffixes, sep="_")], na.rm = TRUE)

# Remove savoury_* columns
df <- df[ , !(names(df) %in% paste("savoury", suffixes, sep="_"))]
rm(columns, savoury_vars, new_column, suffix)

# 8. merge soup:
soup_vars <- c("InstantSoup", "CannnedSoup", "HomeSoup")
# calculate soup_* variables
for(suffix in suffixes) {
  columns <- paste(soup_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("soup", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of soup
df$soup_mean <- rowMeans(df[, paste("soup", suffixes, sep="_")], na.rm = TRUE)

# Remove soup_* columns
df <- df[ , !(names(df) %in% paste("soup", suffixes, sep="_"))]
rm(columns, soup_vars, new_column, suffix)

# 9. merge starchy:
starchy_vars <- c("WhitePasta", "WholemealPasta", "WhiteRice", "BrownRice", "Sushi Snackpot", "Couscous", "OthGrain")
# calculate starchy_* variables
for(suffix in suffixes) {
  columns <- paste(starchy_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("starchy", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of starchy
df$starchy_mean <- rowMeans(df[, paste("starchy", suffixes, sep="_")], na.rm = TRUE)

# Remove starchy_* columns
df <- df[ , !(names(df) %in% paste("starchy", suffixes, sep="_"))]
rm(columns, starchy_vars, new_column, suffix)

write.csv(df, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_grain_dessert.csv",na='',row.names=FALSE)
rm(list=ls())
```