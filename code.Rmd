---
title: "Untitled"
author: "Tim"
date: "2023-07-19"
output: html_document
---

# this is for the food project

## get the data ready: new variables are from the UKb data: ukb42166_2020JUN01. old variables are the same ones for the dairy project



```{Unix}
### get data10 -- get all Continuous data -- UDI from 100002 to 100025
$ cols="1,"$(seq -s, 3338 3447)
cut -d ',' -f ${cols} ukb42166_2020JUN01.csv > data10_continuous.csv
### get data11 -- get liquid data -- UDI from 100150 to 100500; from 100540 to 100550
$ cols="1,"$(seq -s, 3448 3617)","$(seq -s, 3633 3642)
cut -d ',' -f ${cols} ukb42166_2020JUN01.csv > data11_liquids.csv
### get data12 -- get bread/dessert/grain data
$ cols="1,"$(seq -s, 3758 4157)
cut -d ',' -f ${cols} ukb42166_2020JUN01.csv > data12_grain_dessert.csv
### get data13 -- get egg/meat/fish/vegetarian data
$ cols="1,"$(seq -s, 4218 4697)
cut -d ',' -f ${cols} ukb42166_2020JUN01.csv > data13_meat_vege.csv
```

# The provided code is a set of Unix commands intended to extract certain columns from a .csv file and write these columns to new .csv files. To run all of these commands at once, you can put them into a shell script, and then execute the script. Here's how:

1. Open a text editor, and paste the following code into it:

```{bash}
#!/bin/bash

# get data10 -- continuous data -- UDI from 98677 to 99461
cols="1,"$(seq -s, 3339 3448)
cut -d ',' -f ${cols} ukb42166_2020JUN01.csv > data10_continuous.csv

# get data11 -- get liquid data -- UDI from 100150 to 100500; from 100540 to 100550
cols="1,"$(seq -s, 3449 3618)","$(seq -s, 3634 3643)
cut -d ',' -f ${cols} ukb42166_2020JUN01.csv > data11_liquids.csv

# get data12 -- get bread/dessert/grain data
cols="1,"$(seq -s, 3759 4158)
cut -d ',' -f ${cols} ukb42166_2020JUN01.csv > data12_grain_dessert.csv

# get data13 -- get egg/meat/fish/vegetarian data
cols="1,"$(seq -s, 4219 4698)
cut -d ',' -f ${cols} ukb42166_2020JUN01.csv > data13_meat_vege.csv
```

2. Save this file as `extract_columns.sh` or another name of your choosing with the `.sh` extension.

3. Open a terminal window, navigate to the directory where you saved `extract_columns.sh`, and then run the following command to make the script executable:

```{bash}
chmod +x extract_columns.sh
```

4. Now, you can run the script with this command:

```{bash}
./extract_columns.sh
```

# This will execute all of the commands in the script, one after the other.

# the following codes can get all food data done in the onedrive folder
```{r}
#replace names for data11 and get data of liquids done
## 1. replace names for data11
library(dplyr)

df<-read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/data11_liquids.csv',check.names = FALSE)
df <- rename(df, "EID" = "eid")

old_names <- grep("^100150", colnames(df), value = TRUE)
new_names <- sub("^100150", "Water", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100160", colnames(df), value = TRUE)
new_names <- sub("^100160", "LowCalorie", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100170", colnames(df), value = TRUE)
new_names <- sub("^100170", "Fizzy", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100180", colnames(df), value = TRUE)
new_names <- sub("^100180", "Squash", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100190", colnames(df), value = TRUE)
new_names <- sub("^100190", "OrangeJuice", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100200", colnames(df), value = TRUE)
new_names <- sub("^100200", "GrapeJuice", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100210", colnames(df), value = TRUE)
new_names <- sub("^100210", "FruitVegeJuice", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100220", colnames(df), value = TRUE)
new_names <- sub("^100220", "FruitSmoothie", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100230", colnames(df), value = TRUE)
new_names <- sub("^100230", "DairySmoothie", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100240", colnames(df), value = TRUE)
new_names <- sub("^100240", "CoffeeConsume", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100250", colnames(df), value = TRUE)
new_names <- sub("^100250", "InstantCoffee", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100260", colnames(df), value = TRUE)
new_names <- sub("^100260", "AddMilkCoffee", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100270", colnames(df), value = TRUE)
new_names <- sub("^100270", "FilterCoffee", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100280", colnames(df), value = TRUE)
new_names <- sub("^100280", "AddMilkFilterCoffee", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100290", colnames(df), value = TRUE)
new_names <- sub("^100290", "Cappuccino", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100300", colnames(df), value = TRUE)
new_names <- sub("^100300", "Latte", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100310", colnames(df), value = TRUE)
new_names <- sub("^100310", "Espresso", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100320", colnames(df), value = TRUE)
new_names <- sub("^100320", "AddMilkEspresso", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100330", colnames(df), value = TRUE)
new_names <- sub("^100330", "OtherCoffee", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100350", colnames(df), value = TRUE)
new_names <- sub("^100350", "AddMilkOtherCoffee", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100360", colnames(df), value = TRUE)
new_names <- sub("^100360", "DecaffeinCoffee", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100370", colnames(df), value = TRUE)
new_names <- sub("^100370", "SugarAddtoCoffee", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100380", colnames(df), value = TRUE)
new_names <- sub("^100380", "ArtificialSweettoCoffee", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100390", colnames(df), value = TRUE)
new_names <- sub("^100390", "TeaConsume", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100400", colnames(df), value = TRUE)
new_names <- sub("^100400", "StandTea", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100410", colnames(df), value = TRUE)
new_names <- sub("^100410", "RooibosTea", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100420", colnames(df), value = TRUE)
new_names <- sub("^100420", "GreenTea", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100430", colnames(df), value = TRUE)
new_names <- sub("^100430", "HerbalTea", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100440", colnames(df), value = TRUE)
new_names <- sub("^100440", "OtherTea", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100460", colnames(df), value = TRUE)
new_names <- sub("^100460", "AddMilkStandTea", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100470", colnames(df), value = TRUE)
new_names <- sub("^100470", "DecaffeinTea", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100480", colnames(df), value = TRUE)
new_names <- sub("^100480", "AddMilkRooibos", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100490", colnames(df), value = TRUE)
new_names <- sub("^100490", "SugarToTea", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100500", colnames(df), value = TRUE)
new_names <- sub("^100500", "ArtificialSweetTea", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100540", colnames(df), value = TRUE)
new_names <- sub("^100540", "LowCalorieHotChocolate", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100540", colnames(df), value = TRUE)
new_names <- sub("^100540", "LowCalorieHotChocolate", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

old_names <- grep("^100550", colnames(df), value = TRUE)
new_names <- sub("^100550", "HotChocolate", old_names)
colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))

## 2. get liquids data done
#get other variables
dataa<-read.csv(file='C:/Users/timothy/Documents/GWAS_data/dairy/random_effects.csv')
datab <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/dairydata_noIDV.csv')
datac<-merge(dataa,datab,by="EID")
#clean up
rm(dataa,datab)
datab<-merge(df,datac,by="EID")
rm(df)
write.csv(datab, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\food_liquids.csv",na='',row.names=FALSE)
rm(datab,new_names,old_names)


# get data12 -- grain_dessert data done
# Read the data12
df <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/data12_grain_dessert.csv', check.names = FALSE)
df <- rename(df, "EID" = "eid")

# Define a named vector where names are the old column name parts, and the values are the new ones
name_changes <- c("100940-" = "Bread_", "100950-" = "SlicedBread_", "101020-" = "Baguette_", "101090-" = "Bap_",
                  "101160-" = "Breadroll_", "101230-" = "Naanbread_", "101240-" = "Garlicbread_", 
                  "101250-" = "Crispbread_", "101260-" = "Oatcakes_", "101270-" = "Otherbread_", 
                  "101300-" = "Butteronbread_", "101310-" = "NumberofsliceswithButt_", "101350-" = "NumberbaguettewithButt_", 
                  "101390-" = "NumberbapwithButt_", "101430-" = "NumberbreadrollwithButt_", "101470-" = "NumbercrackerwithButt_",
                  "101510-" = "NumberoatcakewithButt_", "101550-" = "NumberOthbreadwithButt_", "101970-" = "DoubleCrustPastry_",
                  "101980-" = "SingleCrustPastry_", "101990-" = "Crumble_", "102000-" = "Pizza_",
                  "102010-" = "Pancake_", "102020-" = "ScotchPancake_", "102030-" = "YorkshirePudd_",
                  "102040-" = "IndiaSnack_", "102050-" = "Croissant_", "102060-" = "DanishPastry_", 
                  "102070-" = "Scone_", "102080-" = "Yogurt_IcecreamConsum_", "102090-" = "Yogurt_",
                  "102120-" = "Icecream_", "102130-" = "DessertConsum_", "102140-" = "MilkPuddin_", "102150-" = "OthMilkPuddin_",
                  "102170-" = "Soya_", "102180-" = "Fruitcake_", "102190-" = "Cake_", "102200-" = "Doughnut_", 
                  "102210-" = "Spongepuddin_", "102220-" = "Cheesecake_", "102230-" = "Othdessert_", 
                  "102250-" = "SweetsnackConsum_", "102260-" = "Chocolatebar_", "102270-" = "WhiteChocolate_", 
                  "102280-" = "MilkChocolate_", "102290-" = "DarkChocolate_", "102300-" = "ChocolateRaisin_", 
                  "102310-" = "Chocolatesweet_", "102320-" = "Dietsweet_", "102330-" = "Sweets_", 
                  "102340-" = "ChocolateCoverBiscuit_", "102350-" = "ChocolateBiscuit_", "102360-" = "SweetBiscuit_", 
                  "102370-" = "CerealBar_", "102380-" = "OthSweet_", "102400-" = "Savoury_", "102410-" = "SaltPeanut_", 
                  "102420-" = "Peanut_", "102430-" = "SaltNut_", "102440-" = "Nut_", "102450-" = "Seeds_", "102460-" = "Crisp_", 
                  "102470-" = "SavouryBiscuit_", "102480-" = "CheesyBiscuit_", "102490-" = "Olives_", "102500-" = "OthSavoury_", 
                  "102520-" = "SoupConsum_", "102530-" = "InstantSoup_", "102540-" = "CannnedSoup_", "102620-" = "HomeSoup_", 
                  "102700-" = "StarchyConsum_", "102710-" = "WhitePasta_", "102720-" = "WholemealPasta_", "102730-" = "WhiteRice_", 
                  "102740-" = "BrownRice_", "102750-" = "Sushi_", "102760-" = "Snackpot_", "102770-" = "Couscous_", "102780-" = "OthGrain_")
# Iterate over name_changes
for (old_name in names(name_changes)) {
  new_name = name_changes[old_name]
  old_names <- grep(paste0("^", old_name), colnames(df), value = TRUE)
  new_names <- sub(paste0("^", old_name), new_name, old_names)
  colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))
}
#clean up
rm(name_changes,new_name,new_names,old_name,old_names)
datab<-merge(df,datac,by="EID")
rm(df)
write.csv(datab, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\food_grain_dessert.csv",na='',row.names=FALSE)
rm(datab)

# get data13 -- meat/vege data done
# Read the data13
df <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/data13_meat_vege.csv', check.names = FALSE)
df <- rename(df, "EID" = "eid")

# Define a named vector where names are the old column name parts, and the values are the new ones
name_changes <- c("102930-" = "EggConsum_", "102940-" = "WholeEgg_", "102950-" = "Omelette_", "102960-" = "EgginSandwich_",
                  "102970-" = "ScotchEgg_", "102980-" = "OthEgg_", "103000-" = "MeatConsum_", 
                  "103010-" = "Sausage_", "103020-" = "Beef_", "103030-" = "Pork_", 
                  "103040-" = "Lamb_", "103050-" = "CrumbPoultry_", "103060-" = "Poultry_", 
                  "103070-" = "Bacon_", "103080-" = "Ham_", "103090-" = "Liver_",
                  "103100-" = "OthMeat_", "103120-" = "FatRemoveMeat_", "103130-" = "SkinRemovdPoultry_", 
                  "103140-" = "FishConsum_", "103150-" = "TinTuna_", "103160-" = "OilyFish_", 
                  "103170-" = "BreadFish_", "103180-" = "BatteredFish_", "103190-" = "WhiteFish_", 
                  "103200-" = "Prawns_", "103210-" = "LobsterCrab_", "103220-" = "Shellfish_", 
                  "103230-" = "OthFish_", "103250-" = "VegeAlter_", "103260-" = "VegeSausage_", 
                  "103270-" = "Tofu_", "103280-" = "Quorn_", "103290-" = "OthVegeAlter_", "103310-" = "SpreadConsum_", 
                  "103980-" = "NoFatCook_", "103990-" = "VegeConsum_", "104000-" = "BakeBean_", "104010-" = "Pulse_", 
                  "104020-" = "FriedPotato_", "104030-" = "BoilPotato_", "104040-" = "ButterAddPotato_", 
                  "104050-" = "MashPotato_", "104060-" = "MixVege_", "104070-" = "VegePiece_", 
                  "104080-" = "Coleslaw_", "104090-" = "SideSalad_", "104100-" = "Avocado_", "104110-" = "BroadBean_", 
                  "104120-" = "GreenBean_", "104130-" = "Beetroot_", "104140-" = "Broccoli_", "104150-" = "Butternut_", 
                  "104160-" = "Cabbage_", "104170-" = "Carrot_", "104180-" = "Cauliflower_", "104190-" = "Celery_", "104200-" = "Courgette_", 
                  "104210-" = "Cucumber_", "104220-" = "Garlic_", "104230-" = "Leek_", "104240-" = "Lettuce_", "104250-" = "Mushroom_", 
                  "104260-" = "Onion_", "104270-" = "Parsnip_", "104280-" = "Pea_", "104290-" = "Sweetpepper_", "104300-" = "Spinach_", 
                  "104310-" = "Sprouts_", "104320-" = "Sweetcorn_", "104330-" = "Sweetpotato_", "104340-" = "FreshTomato_", 
                  "104350-" = "TinTomato_", "104360-" = "Turnip_", "104370-" = "Watercress_", "104380-" = "OthVege_", 
                  "104400-" = "FruitConsum_", "104410-" = "StewedFruit_", "104420-" = "Prune_", "104430-" = "DriedFruit_", 
                  "104440-" = "MixFruit_", "104450-" = "Apple_", "104460-" = "Banana_", "104470-" = "Berry_", "104480-" = "Cherry_", 
                  "104490-" = "Grapefruit_", "104500-" = "Grape_", "104510-" = "Mango_", "104520-" = "Melon_", "104530-" = "Orange_", 
                  "104540-" = "Satsuma_", "104550-" = "Peach_", "104560-" = "Pear_", "104570-" = "Pineapple_", "104580-" = "Plum_", 
                  "104590-" = "OthFruit_", "104660-" = "AddSalt_", "104670-" = "VitaminSupplement_")

# Iterate over name_changes
for (old_name in names(name_changes)) {
  new_name = name_changes[old_name]
  old_names <- grep(paste0("^", old_name), colnames(df), value = TRUE)
  new_names <- sub(paste0("^", old_name), new_name, old_names)
  colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))
}
#clean up
rm(name_changes,new_name,new_names,old_name,old_names)
datab<-merge(df,datac,by="EID")
rm(df)
write.csv(datab, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\food_meat_vege.csv",na='',row.names=FALSE)
rm(datab)

# get data10 -- continuous data done
# Read the data10
df <- read.csv(file = 'C:/Users/timothy/Documents/GWAS_data/dairy/data10_continuous.csv', check.names = FALSE)
df <- rename(df, "EID" = "eid")
# replace unusual values: time format, 0, 1, 2, and with letters(starting with A)
# Define the function to check and replace unusual values
replace_unusual <- function(x) {
  x <- as.character(x)
  
  # Replace values starting with 'A'
  x[startsWith(x, "A")] <- NA
  
  # Replace values in ISO 8601 date-time format (YYYY-MM-DDTHH:MM:SS)
  x[grepl("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}$", x)] <- NA
  
  # Replace values equals to 0
  x[x %in% c("0")] <- NA
  
  return(x)
}

# Apply the function to all desired columns in the dataframe
cols <- colnames(df) # Adjust this if you want to apply it to specific columns only
df[cols] <- lapply(df[cols], replace_unusual)
#clean up
rm(cols,replace_unusual)
# Define a named vector where names are the old column name parts, and the values are the new ones
name_changes <- c("100002" = "Energy", "100003" = "Protein", "100004" = "Fat", "100005" = "Carbohydrate",
                  "100006" = "SaturateFat", "100007" = "PolyunsaturatFat", "100008" = "Sugars", 
                  "100009" = "EnglystDietaryFibre", "100011" = "Iron", "100012" = "VB6", 
                  "100013" = "VB12", "100014" = "Folate", "100015" = "VC", 
                  "100016" = "Potassium", "100017" = "Magnesium", "100018" = "Retinol",
                  "100019" = "Carotene", "100021" = "VD", "100022" = "Alcohol_continuous",
                  "100023" = "Starch", "100024" = "Calcium", "100025" = "VE")
# Iterate over name_changes
for (old_name in names(name_changes)) {
  new_name = name_changes[old_name]
  old_names <- grep(paste0("^", old_name), colnames(df), value = TRUE)
  new_names <- sub(paste0("^", old_name), new_name, old_names)
  colnames(df) <- ifelse(colnames(df) %in% old_names, new_names, colnames(df))
}
#clean up
rm(name_changes,new_name,new_names,old_name,old_names)
datab<-merge(df,datac,by="EID")
rm(df)
write.csv(datab, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\food_contious.csv",na='',row.names=FALSE)
rm(list=ls())
```


```{r}
#get mean values for the continuous data
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\food_contious.csv')

# List of variables
variables <- c("Energy", "Protein", "Fat", "Carbohydrate", "SaturateFat", "PolyunsaturatFat", 
               "Sugars", "EnglystDietaryFibre", "Iron", "VB6", "VB12", "Folate", 
               "VC", "Potassium", "Magnesium", "Retinol", "Carotene", "VD", 
               "Alcohol_continuous", "Starch", "Calcium", "VE")
# Suffix for each variable
suffix <- c("_1.0", "_2.0", "_3.0", "_4.0", "_0.0")
# Loop through all variables
for (var in variables) {
  # Generate the column names for each variable
  cols <- paste0(var, suffix)
  # Check if columns exist in the dataframe
  if (all(cols %in% colnames(df))) {
    # Calculate the mean
    df[[paste0(var, "_mean")]] <- rowMeans(df[, cols], na.rm = TRUE)
  } else {
    # Print a message if columns are not found in the dataframe
    print(paste("Columns for variable", var, "not found in the dataframe."))
  }
}
#removed the column from the dataframe
# Create an empty vector to store all the column names
cols_to_remove <- c()

# Loop through all variables
for (var in variables) {
  
  # Generate the column names for each variable
  cols <- paste0(var, suffix)
  
  # Append to the list of columns to remove
  cols_to_remove <- c(cols_to_remove, cols)
}

# Remove the columns from the dataframe
df <- df[ , !(colnames(df) %in% cols_to_remove)]

write.csv(df, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_continuous.csv",na='',row.names=FALSE)
rm(list=ls())
```

```{r}
#main effects test for continuous data
library(lmerTest)
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_continuous.csv')
# Fit the model
df$APOE_all <- as.factor(df$APOE_all)
df$T40_Gcar <- as.factor(df$T40_Gcar)
df$family_history_AD <- as.factor(df$family_history_AD)
df$Sex <- as.factor(df$Sex)
df$AlcoholY08 <- as.factor(df$AlcoholY08)
df$SmokingY08 <- as.factor(df$SmokingY08)
df$Assessment_0 <- as.factor(df$Assessment_0)
df$EID <- as.factor(df$EID)
results <- data.frame()
# List of variables to test
test_vars <- c("Energy_mean", "Protein_mean", "Fat_mean", "Carbohydrate_mean", "SaturateFat_mean", 
               "PolyunsaturatFat_mean", "Sugars_mean", "EnglystDietaryFibre_mean", "Iron_mean", "VB6_mean", 
               "VB12_mean", "Folate_mean", "VC_mean", "Potassium_mean", "Magnesium_mean", "Retinol_mean", 
               "Carotene_mean", "VD_mean", "Alcohol_continuous_mean", "Starch_mean", "Calcium_mean", "VE_mean")

dependent_vars <- c("rsfMRI_Component1", "rsfMRI_Component5", "rsfMRI_Component7", "rsfMRI_Component9", 
                    "rsfMRI_Component10", "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component20")

# Double loop through each dependent and test variable and fit the model
for (dep_var in dependent_vars) {
  for (test_var in test_vars) {
  
    # Construct the formula
    formula <- as.formula(paste(dep_var, "~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + 
                               BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend +", test_var, "+ 
                               (1 | Assessment_0)"))
  
    # Fit the model
    model <- lmer(formula, data = df, REML=FALSE)
    
   # Get the summary
    model_summary <- summary(model)
    
    # Extract the results for the test variable
    estimate <- model_summary$coefficients[test_var, "Estimate"]
    std_error <- model_summary$coefficients[test_var, "Std. Error"]
    p_value <- model_summary$coefficients[test_var, "Pr(>|t|)"]
    
    # Add the results to the data frame
    results <- rbind(results, data.frame(Dependent_Variable = dep_var,
                                         Test_Variable = test_var,
                                         Estimate = estimate,
                                         Std_Error = std_error,
                                         p_value = p_value))
  }
}
write.csv(results, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\output\\maineffect_continuous.csv",na='',row.names=FALSE)
rm(list=ls())
```

```{r}
#interaction test for continuous data
library(lmerTest)
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_continuous.csv')

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID")
for (var in factor_vars) {
  df[[var]] <- as.factor(df[[var]])
}
rm(factor_vars,var)

# Scale all continuous variables
scale_vars <- c("Energy_mean", "Protein_mean", "Fat_mean", "Carbohydrate_mean", "SaturateFat_mean", 
               "PolyunsaturatFat_mean", "Sugars_mean", "EnglystDietaryFibre_mean", "Iron_mean", "VB6_mean", 
               "VB12_mean", "Folate_mean", "VC_mean", "Potassium_mean", "Magnesium_mean", "Retinol_mean", 
               "Carotene_mean", "VD_mean", "Alcohol_continuous_mean", "Starch_mean", "Calcium_mean", "VE_mean", 
               "rsfMRI_Component1", "rsfMRI_Component5", "rsfMRI_Component7", "rsfMRI_Component9", "rsfMRI_Component10", 
               "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component20", "Age_Baseline", "BMI_Y08andY12andY14_mean")

for (var in scale_vars) {
  df[[var]] <- scale(df[[var]])
}
rm(scale_vars, var)

# Define the dependent variables
dependent_vars <- c("rsfMRI_Component1", "rsfMRI_Component5", "rsfMRI_Component7", "rsfMRI_Component9", 
                    "rsfMRI_Component10", "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component20")

# List of variables to test
test_vars <- c("Energy_mean", "Protein_mean", "Fat_mean", "Carbohydrate_mean", "SaturateFat_mean", 
               "PolyunsaturatFat_mean", "Sugars_mean", "EnglystDietaryFibre_mean", "Iron_mean", "VB6_mean", 
               "VB12_mean", "Folate_mean", "VC_mean", "Potassium_mean", "Magnesium_mean", "Retinol_mean", 
               "Carotene_mean", "VD_mean", "Alcohol_continuous_mean", "Starch_mean", "Calcium_mean", "VE_mean")

# List of factors
factor_vars <- c("APOE_all", "T40_Gcar", "family_history_AD")

# Initialize a results data frame
results <- data.frame()

# Loop over each dependent variable
for(factor_var in factor_vars) {
 for (dep_var in dependent_vars) {
  for (test_var in test_vars) {
      
    # Construct the formula
    formula <- as.formula(paste(dep_var, "~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + 
                               BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend +", factor_var, ":", test_var, "+ 
                               (1 | Assessment_0)"))
  
    # Fit the model
    model <- lmer(formula, data = df, REML=FALSE)

    # Get the summary
    model_summary <- summary(model)
   
    # Extract the results for the interaction term
    interaction_term <- paste(factor_var, test_var, sep=":")
    estimate <- model_summary$coefficients[interaction_term, "Estimate"]
    std_error <- model_summary$coefficients[interaction_term, "Std. Error"]
    p_value <- model_summary$coefficients[interaction_term, "Pr(>|t|)"]

    # Add the results to the data frame
    results <- rbind(results, data.frame(Dependent_Variable = dep_var,
                                         Factors = factor_var,
                                         Test_Variable = test_var,
                                         Estimate = estimate,
                                         Std_Error = std_error,
                                         P_Value = p_value))
    }
  }
}
write.csv(results, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\output\\interactions_continuous.csv",na='',row.names=FALSE)
rm(list=ls())
```


```{r}
#work on food_liquids
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_liquids.csv')
# remove invalid values
# wanted variables
variables <- c("Water_1.0", "Water_2.0", "Water_3.0", "Water_4.0", "Water_0.0",
               "LowCalorie_1.0", "LowCalorie_2.0", "LowCalorie_3.0", "LowCalorie_4.0", "LowCalorie_0.0",
               "Fizzy_1.0", "Fizzy_2.0", "Fizzy_3.0", "Fizzy_4.0", "Fizzy_0.0",
               "Squash_1.0", "Squash_2.0", "Squash_3.0", "Squash_4.0", "Squash_0.0",
               "OrangeJuice_1.0", "OrangeJuice_2.0", "OrangeJuice_3.0", "OrangeJuice_4.0", "OrangeJuice_0.0",
               "GrapeJuice_1.0", "GrapeJuice_2.0", "GrapeJuice_3.0", "GrapeJuice_4.0", "GrapeJuice_0.0",
               "FruitVegeJuice_1.0", "FruitVegeJuice_2.0", "FruitVegeJuice_3.0", "FruitVegeJuice_4.0", "FruitVegeJuice_0.0",
               "FruitSmoothie_1.0", "FruitSmoothie_2.0", "FruitSmoothie_3.0", "FruitSmoothie_4.0", "FruitSmoothie_0.0",
               "DairySmoothie_1.0", "DairySmoothie_2.0", "DairySmoothie_3.0", "DairySmoothie_4.0", "DairySmoothie_0.0", 
               "InstantCoffee_1.0",	"InstantCoffee_2.0", "InstantCoffee_3.0", "InstantCoffee_4.0", "InstantCoffee_0.0",
               "FilterCoffee_1.0", "FilterCoffee_2.0", "FilterCoffee_3.0", "FilterCoffee_4.0", "FilterCoffee_0.0", 
               "Cappuccino_1.0", "Cappuccino_2.0", "Cappuccino_3.0", "Cappuccino_4.0", "Cappuccino_0.0", 
               "Latte_1.0", "Latte_2.0", "Latte_3.0", "Latte_4.0", "Latte_0.0", 
               "Espresso_1.0", "Espresso_2.0", "Espresso_3.0", "Espresso_4.0", "Espresso_0.0", 
               "OtherCoffee_1.0", "OtherCoffee_2.0", "OtherCoffee_3.0", "OtherCoffee_4.0", "OtherCoffee_0.0", 
               "LCalorieHotChocolate_1.0", "LCalorieHotChocolate_2.0", "LCalorieHotChocolate_3.0", 
               "LCalorieHotChocolate_4.0", "LCalorieHotChocolate_0.0", 
               "HChocolate_1.0", "HChocolate_2.0", "HChocolate_3.0", "HChocolate_4.0", "HChocolate_0.0")
# consumption variables (can be only 0 or 1)
cvariables <- c("CoffeeConsume_1.0", "CoffeeConsume_2.0",	"CoffeeConsume_3.0",	"CoffeeConsume_4.0",	"CoffeeConsume_0.0", "TeaConsume_1.0",	"TeaConsume_2.0",	"TeaConsume_3.0",	"TeaConsume_4.0",	"TeaConsume_0.0")
# invalid values are with decimal (replace all non-integer (decimal) values in the specified columns of the df data frame with NA)
df[, variables] <- lapply(df[, variables], function(x) ifelse(x == floor(x), x, NA))
# define valid values
valid_jvalues <- c(0, 1, 2, 3, 4, 5, 555, 600)
valid_cvalues <- c(0, 1)
# only keep valid values for wanted variables
df[, variables] <- lapply(df[, variables], function(x) ifelse(x %in% valid_jvalues, x, NA))
# only keep valid values for consumption variables
df[, cvariables] <- lapply(df[, cvariables], function(x) ifelse(x %in% valid_cvalues, x, NA))
# remove unwanted variables
library(dplyr)
# variables to remove
variables_to_remove <- c("AddMilkFilterCoffee_1.0", "AddMilkFilterCoffee_2.0", "AddMilkFilterCoffee_3.0", 
                         "AddMilkFilterCoffee_4.0", "AddMilkFilterCoffee_0.0", "AddMilkCoffee_1.0", 
                         "AddMilkCoffee_2.0", "AddMilkCoffee_3.0", "AddMilkCoffee_4.0", "AddMilkCoffee_0.0",
                         "SugarAddtoCoffee_1.0", "SugarAddtoCoffee_2.0", "SugarAddtoCoffee_3.0", 
                         "SugarAddtoCoffee_4.0", "SugarAddtoCoffee_0.0", "ArtificialSweettoCoffee_1.0", "ArtificialSweettoCoffee_2.0",
                         "ArtificialSweettoCoffee_3.0", "ArtificialSweettoCoffee_4.0", "ArtificialSweettoCoffee_0.0", 
                         "AddMilkStandTea_1.0", "AddMilkStandTea_2.0", "AddMilkStandTea_3.0", "AddMilkStandTea_4.0", 
                         "AddMilkStandTea_0.0", "DecaffeinTea_1.0", "DecaffeinTea_2.0", "DecaffeinTea_3.0", 
                         "DecaffeinTea_4.0", "DecaffeinTea_0.0", "AddMilkRooibos_1.0", "AddMilkRooibos_2.0", 
                         "AddMilkRooibos_3.0", "AddMilkRooibos_4.0", "AddMilkRooibos_0.0", "SugarToTea_1.0", 
                         "SugarToTea_2.0", "SugarToTea_3.0", "SugarToTea_4.0", "SugarToTea_0.0", "ArtificialSweetTea_1.0", 
                         "ArtificialSweetTea_2.0", "ArtificialSweetTea_3.0", "ArtificialSweetTea_4.0", "ArtificialSweetTea_0.0")
df <- df %>% select(-one_of(variables_to_remove))
# replace "555" and "600"
df[, variables] <- lapply(df[, variables], function(x) { 
    x <- ifelse(x == 555, 0.5, x) 
    x <- ifelse(x == 600, 6, x)
    x
})
rm(cvariables, valid_cvalues, valid_jvalues, variables, variables_to_remove)
# List of variables
variables <- c("Water", "LowCalorie", "Fizzy", "Squash", "OrangeJuice", "GrapeJuice", "FruitVegeJuice", "FruitSmoothie", "DairySmoothie", "InstantCoffee", "FilterCoffee", "Cappuccino", "Latte", "Espresso", "OtherCoffee", "LCalorieHotChocolate", "HChocolate")
# Suffix for each variable
suffix <- c("_1.0", "_2.0", "_3.0", "_4.0", "_0.0")
# Loop through all variables
for (var in variables) {
  # Generate the column names for each variable
  cols <- paste0(var, suffix)
  # Check if columns exist in the dataframe
  if (all(cols %in% colnames(df))) {
    # Calculate the mean
    df[[paste0(var, "_mean")]] <- rowMeans(df[, cols], na.rm = TRUE)
  }
}
rm(cols, suffix, var, variables)

# merge juice and coffee
# 1. merge juice:
juice_vars <- c("Fizzy", "Squash", "OrangeJuice", "GrapeJuice", 
                "FruitVegeJuice", "FruitSmoothie", "DairySmoothie")
suffixes <- c("1.0", "2.0", "3.0", "4.0", "0.0")

# calculate juice_* variables
for(suffix in suffixes) {
  columns <- paste(juice_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("juice", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of juice
df$juice_mean <- rowMeans(df[, paste("juice", suffixes, sep="_")], na.rm = TRUE)

# Remove juice_* columns
df <- df[ , !(names(df) %in% paste("juice", suffixes, sep="_"))]
rm(columns, juice_vars, new_column, suffix)

# 2. merge coffee:
coffee_vars <- c("InstantCoffee", "FilterCoffee", "Cappuccino", "Latte", 
                "Espresso", "OtherCoffee")
# calculate coffee_* variables
for(suffix in suffixes) {
  columns <- paste(coffee_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("coffee", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of coffee
df$coffee_mean <- rowMeans(df[, paste("coffee", suffixes, sep="_")], na.rm = TRUE)

# Remove coffee_* columns
df <- df[ , !(names(df) %in% paste("coffee", suffixes, sep="_"))]

write.csv(df, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_liquids1.csv",na='',row.names=FALSE)
rm(list=ls())
```

```{r}
# get the grain_dessert data ready to go
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\food_grain_dessert.csv')
# remove invalid values
# wanted variables
bread_variables <- c("SlicedBread_1.0", "SlicedBread_2.0", "SlicedBread_3.0", "SlicedBread_4.0", "SlicedBread_0.0",
                     "Baguette_1.0", "Baguette_2.0", "Baguette_3.0", "Baguette_4.0", "Baguette_0.0", 
                     "Bap_1.0", "Bap_2.0", "Bap_3.0", "Bap_4.0", "Bap_0.0", "Breadroll_1.0", "Breadroll_2.0", 
                     "Breadroll_3.0", "Breadroll_4.0", "Breadroll_0.0", "Naanbread_1.0", "Naanbread_2.0", 
                     "Naanbread_3.0", "Naanbread_4.0", "Naanbread_0.0", "Garlicbread_1.0", "Garlicbread_2.0", 
                     "Garlicbread_3.0", "Garlicbread_4.0", "Garlicbread_0.0", "Crispbread_1.0", "Crispbread_2.0", 
                     "Crispbread_3.0", "Crispbread_4.0", "Crispbread_0.0", "Oatcakes_1.0", "Oatcakes_2.0", 
                     "Oatcakes_3.0", "Oatcakes_4.0", "Oatcakes_0.0", "Otherbread_1.0", "Otherbread_2.0", 
                     "Otherbread_3.0", "Otherbread_4.0", "Otherbread_0.0")

nubread_variables <- c("NumberofsliceswithButt_1.0", "NumberofsliceswithButt_2.0", "NumberofsliceswithButt_3.0", 
                       "NumberofsliceswithButt_4.0", "NumberofsliceswithButt_0.0", "NumberbaguettewithButt_1.0", 
                       "NumberbaguettewithButt_2.0", "NumberbaguettewithButt_3.0", "NumberbaguettewithButt_4.0", 
                       "NumberbaguettewithButt_0.0", "NumberbapwithButt_1.0", "NumberbapwithButt_2.0", 
                       "NumberbapwithButt_3.0", "NumberbapwithButt_4.0", "NumberbapwithButt_0.0", 
                       "NumberbreadrollwithButt_1.0", "NumberbreadrollwithButt_2.0", "NumberbreadrollwithButt_3.0", 
                       "NumberbreadrollwithButt_4.0", "NumberbreadrollwithButt_0.0", "NumbercrackerwithButt_1.0", 
                       "NumbercrackerwithButt_2.0", "NumbercrackerwithButt_3.0", "NumbercrackerwithButt_4.0", 
                       "NumbercrackerwithButt_0.0", "NumberoatcakewithButt_1.0", "NumberoatcakewithButt_2.0", 
                       "NumberoatcakewithButt_3.0", "NumberoatcakewithButt_4.0", "NumberoatcakewithButt_0.0", 
                       "NumberOthbreadwithButt_1.0", "NumberOthbreadwithButt_2.0", "NumberOthbreadwithButt_3.0", 
                       "NumberOthbreadwithButt_4.0", "NumberOthbreadwithButt_0.0")

pie_variables <- c("DoubleCrustPastry_1.0", "DoubleCrustPastry_2.0", "DoubleCrustPastry_3.0", "DoubleCrustPastry_4.0", "DoubleCrustPastry_0.0",
                   "SingleCrustPastry_1.0", "SingleCrustPastry_2.0", "SingleCrustPastry_3.0", "SingleCrustPastry_4.0", "SingleCrustPastry_0.0",
                   "Crumble_1.0", "Crumble_2.0", "Crumble_3.0", "Crumble_4.0", "Crumble_0.0", 
                   "Pizza_1.0", "Pizza_2.0", "Pizza_3.0", "Pizza_4.0", "Pizza_0.0",
                   "Pancake_1.0","Pancake_2.0","Pancake_3.0","Pancake_4.0","Pancake_0.0",
                   "ScotchPancake_1.0","ScotchPancake_2.0","ScotchPancake_3.0","ScotchPancake_4.0","ScotchPancake_0.0",
                   "YorkshirePudd_1.0","YorkshirePudd_2.0","YorkshirePudd_3.0","YorkshirePudd_4.0","YorkshirePudd_0.0",
                   "IndiaSnack_1.0","IndiaSnack_2.0","IndiaSnack_3.0","IndiaSnack_4.0","IndiaSnack_0.0",
                   "Croissant_1.0","Croissant_2.0","Croissant_3.0","Croissant_4.0","Croissant_0.0",
                   "DanishPastry_1.0","DanishPastry_2.0","DanishPastry_3.0","DanishPastry_4.0","DanishPastry_0.0",
                   "Scone_1.0","Scone_2.0","Scone_3.0","Scone_4.0","Scone_0.0")

dessert_variables <- c("Yogurt_1.0", "Yogurt_2.0", "Yogurt_3.0", "Yogurt_4.0", "Yogurt_0.0", 
                       "Icecream_1.0", "Icecream_2.0", "Icecream_3.0", "Icecream_4.0", "Icecream_0.0", 
                       "OthMilkPuddin_1.0", "OthMilkPuddin_2.0", "OthMilkPuddin_3.0", "OthMilkPuddin_4.0", "OthMilkPuddin_0.0", 
                       "Soya_1.0", "Soya_2.0", "Soya_3.0", "Soya_4.0", "Soya_0.0", 
                       "Fruitcake_1.0", "Fruitcake_2.0", "Fruitcake_3.0", "Fruitcake_4.0", "Fruitcake_0.0", 
                       "Cake_1.0", "Cake_2.0", "Cake_3.0", "Cake_4.0", "Cake_0.0", 
                       "Doughnut_1.0", "Doughnut_2.0", "Doughnut_3.0", "Doughnut_4.0", "Doughnut_0.0", 
                       "Spongepuddin_1.0", "Spongepuddin_2.0", "Spongepuddin_3.0", "Spongepuddin_4.0", "Spongepuddin_0.0", 
                       "Cheesecake_1.0", "Cheesecake_2.0", "Cheesecake_3.0", "Cheesecake_4.0", "Cheesecake_0.0", 
                       "Othdessert_1.0", "Othdessert_2.0", "Othdessert_3.0", "Othdessert_4.0", "Othdessert_0.0")

sweet_variables <- c("Chocolatebar_1.0", "Chocolatebar_2.0", "Chocolatebar_3.0", "Chocolatebar_4.0", "Chocolatebar_0.0", 
                     "WhiteChocolate_1.0", "WhiteChocolate_2.0", "WhiteChocolate_3.0", "WhiteChocolate_4.0", "WhiteChocolate_0.0", 
                     "MilkChocolate_1.0", "MilkChocolate_2.0", "MilkChocolate_3.0", "MilkChocolate_4.0", "MilkChocolate_0.0", 
                     "DarkChocolate_1.0", "DarkChocolate_2.0", "DarkChocolate_3.0", "DarkChocolate_4.0", "DarkChocolate_0.0", 
                     "ChocolateRaisin_1.0", "ChocolateRaisin_2.0", "ChocolateRaisin_3.0", "ChocolateRaisin_4.0", "ChocolateRaisin_0.0",
                     "Chocolatesweet_1.0", "Chocolatesweet_2.0", "Chocolatesweet_3.0", "Chocolatesweet_4.0", "Chocolatesweet_0.0", 
                     "Dietsweet_1.0", "Dietsweet_2.0", "Dietsweet_3.0", "Dietsweet_4.0", "Dietsweet_0.0", 
                     "Sweets_1.0", "Sweets_2.0", "Sweets_3.0", "Sweets_4.0", "Sweets_0.0", 
                     "ChocolateCoverBiscuit_1.0", "ChocolateCoverBiscuit_2.0", "ChocolateCoverBiscuit_3.0", "ChocolateCoverBiscuit_4.0", "ChocolateCoverBiscuit_0.0", 
                     "ChocolateBiscuit_1.0", "ChocolateBiscuit_2.0", "ChocolateBiscuit_3.0", "ChocolateBiscuit_4.0", "ChocolateBiscuit_0.0",
                     "SweetBiscuit_1.0", "SweetBiscuit_2.0", "SweetBiscuit_3.0", "SweetBiscuit_4.0", "SweetBiscuit_0.0", 
                     "CerealBar_1.0", "CerealBar_2.0", "CerealBar_3.0", "CerealBar_4.0", "CerealBar_0.0", 
                     "OthSweet_1.0", "OthSweet_2.0", "OthSweet_3.0", "OthSweet_4.0", "OthSweet_0.0")

savoury_variables <- c("SaltPeanut_1.0", "SaltPeanut_2.0", "SaltPeanut_3.0", "SaltPeanut_4.0", "SaltPeanut_0.0", 
                       "Peanut_1.0", "Peanut_2.0", "Peanut_3.0", "Peanut_4.0", "Peanut_0.0", 
                       "SaltNut_1.0", "SaltNut_2.0", "SaltNut_3.0", "SaltNut_4.0", "SaltNut_0.0", 
                       "Nut_1.0", "Nut_2.0", "Nut_3.0", "Nut_4.0", "Nut_0.0", 
                       "Seeds_1.0", "Seeds_2.0", "Seeds_3.0", "Seeds_4.0", "Seeds_0.0", 
                       "Crisp_1.0", "Crisp_2.0", "Crisp_3.0", "Crisp_4.0", "Crisp_0.0", 
                       "SavouryBiscuit_1.0", "SavouryBiscuit_2.0", "SavouryBiscuit_3.0", "SavouryBiscuit_4.0", "SavouryBiscuit_0.0", 
                       "CheesyBiscuit_1.0", "CheesyBiscuit_2.0", "CheesyBiscuit_3.0", "CheesyBiscuit_4.0", "CheesyBiscuit_0.0", 
                       "Olives_1.0", "Olives_2.0", "Olives_3.0", "Olives_4.0", "Olives_0.0", 
                       "OthSavoury_1.0", "OthSavoury_2.0", "OthSavoury_3.0", "OthSavoury_4.0", "OthSavoury_0.0")

soup_variables <- c("InstantSoup_1.0", "InstantSoup_2.0", "InstantSoup_3.0", "InstantSoup_4.0", "InstantSoup_0.0", 
                    "CannnedSoup_1.0", "CannnedSoup_2.0", "CannnedSoup_3.0", "CannnedSoup_4.0", "CannnedSoup_0.0", 
                    "HomeSoup_1.0", "HomeSoup_2.0", "HomeSoup_3.0", "HomeSoup_4.0", "HomeSoup_0.0")

starchy_variables <- c("WhitePasta_1.0", "WhitePasta_2.0", "WhitePasta_3.0", "WhitePasta_4.0", "WhitePasta_0.0", 
                       "WholemealPasta_1.0", "WholemealPasta_2.0", "WholemealPasta_3.0", "WholemealPasta_4.0", "WholemealPasta_0.0", 
                       "WhiteRice_1.0", "WhiteRice_2.0", "WhiteRice_3.0", "WhiteRice_4.0", "WhiteRice_0.0", 
                       "BrownRice_1.0", "BrownRice_2.0", "BrownRice_3.0", "BrownRice_4.0", "BrownRice_0.0", 
                       "Sushi_1.0", "Sushi_2.0", "Sushi_3.0", "Sushi_4.0", "Sushi_0.0", 
                       "Snackpot_1.0", "Snackpot_2.0", "Snackpot_3.0", "Snackpot_4.0", "Snackpot_0.0", 
                       "Couscous_1.0", "Couscous_2.0", "Couscous_3.0", "Couscous_4.0", "Couscous_0.0", 
                       "OthGrain_1.0", "OthGrain_2.0", "OthGrain_3.0", "OthGrain_4.0", "OthGrain_0.0")
# consumption variables (can be only 0 or 1)
cvariables <- c("Bread_1.0", "Bread_2.0", "Bread_3.0", "Bread_4.0", "Bread_0.0", "Butteronbread_1.0", "Butteronbread_2.0", "Butteronbread_3.0", "Butteronbread_4.0", "Butteronbread_0.0", "Yogurt_IcecreamConsum_1.0", "Yogurt_IcecreamConsum_2.0", "Yogurt_IcecreamConsum_3.0", "Yogurt_IcecreamConsum_4.0", "Yogurt_IcecreamConsum_0.0", "DessertConsum_1.0", "DessertConsum_2.0", "DessertConsum_3.0", "DessertConsum_4.0", "DessertConsum_0.0", "SweetsnackConsum_1.0", "SweetsnackConsum_2.0", "SweetsnackConsum_3.0", "SweetsnackConsum_4.0", "SweetsnackConsum_0.0", "Savoury_1.0", "Savoury_2.0", "Savoury_3.0", "Savoury_4.0", "Savoury_0.0", "SoupConsum_1.0", "SoupConsum_2.0", "SoupConsum_3.0", "SoupConsum_4.0", "SoupConsum_0.0", "StarchyConsum_1.0", "StarchyConsum_2.0", "StarchyConsum_3.0", "StarchyConsum_4.0", "StarchyConsum_0.0")
# define valid values
valid_bread_values <- c(1, 2, 3, 4, 5, 600, 555)
valid_pie_values <- c(1, 2, 3, 400, 555)
valid_dessert_values <- c(1, 2, 300, 555)
valid_sweet_values <- c(1, 2, 3, 4, 500, 444, 555)
valid_savoury_values <- c(1, 2, 300, 555)
valid_soup_values <- c(1, 2, 3, 400, 555)
valid_starchy_values <- c(1,200, 555)
valid_cvalues <- c(0, 1)
# only keep valid values for wanted variables
df[, bread_variables] <- lapply(df[, bread_variables], function(x) ifelse(x %in% valid_bread_values, x, NA))
df[, nubread_variables] <- lapply(df[, nubread_variables], function(x) ifelse(x %in% valid_bread_values, x, NA))
df[, pie_variables] <- lapply(df[, pie_variables], function(x) ifelse(x %in% valid_pie_values, x, NA))
df[, dessert_variables] <- lapply(df[, dessert_variables], function(x) ifelse(x %in% valid_dessert_values, x, NA))
df[, sweet_variables] <- lapply(df[, sweet_variables], function(x) ifelse(x %in% valid_sweet_values, x, NA))
df[, savoury_variables] <- lapply(df[, savoury_variables], function(x) ifelse(x %in% valid_savoury_values, x, NA))
df[, soup_variables] <- lapply(df[, soup_variables], function(x) ifelse(x %in% valid_soup_values, x, NA))
df[, starchy_variables] <- lapply(df[, starchy_variables], function(x) ifelse(x %in% valid_starchy_values, x, NA))
df[, cvariables] <- lapply(df[, cvariables], function(x) ifelse(x %in% valid_cvalues, x, NA))
# replace values
df[, bread_variables] <- lapply(df[, bread_variables], function(x) { 
    x <- ifelse(x == 555, 0.5, x) 
    x <- ifelse(x == 600, 6, x)
    x
})
df[, nubread_variables] <- lapply(df[, nubread_variables], function(x) { 
    x <- ifelse(x == 555, 0.5, x) 
    x <- ifelse(x == 600, 6, x)
    x
})
df[, pie_variables] <- lapply(df[, pie_variables], function(x) { 
    x <- ifelse(x == 555, 0.5, x) 
    x <- ifelse(x == 400, 4, x)
    x
})
df[, dessert_variables] <- lapply(df[, dessert_variables], function(x) { 
    x <- ifelse(x == 555, 0.5, x) 
    x <- ifelse(x == 300, 3, x)
    x
})
df[, sweet_variables] <- lapply(df[, sweet_variables], function(x) { 
    x <- ifelse(x == 555, 0.5, x) 
    x <- ifelse(x == 500, 5, x)
    x <- ifelse(x == 444, 0.25, x)
    x
})
df[, savoury_variables] <- lapply(df[, savoury_variables], function(x) { 
    x <- ifelse(x == 555, 0.5, x) 
    x <- ifelse(x == 300, 3, x)
    x
})
df[, soup_variables] <- lapply(df[, soup_variables], function(x) { 
    x <- ifelse(x == 555, 0.5, x) 
    x <- ifelse(x == 400, 4, x)
    x
})
df[, starchy_variables] <- lapply(df[, starchy_variables], function(x) { 
    x <- ifelse(x == 555, 0.5, x) 
    x <- ifelse(x == 200, 2, x)
    x
})

rm(valid_bread_values, valid_pie_values,valid_dessert_values, valid_sweet_values, valid_savoury_values, valid_soup_values, valid_starchy_values, valid_cvalues)

# List of variables
variables <- c("SlicedBread", "Baguette", "Bap", "Breadroll", "Naanbread", "Garlicbread", "Crispbread", "Oatcakes", "Otherbread", "NumberofsliceswithButt", "NumberbaguettewithButt", "NumberbapwithButt", "NumberbreadrollwithButt", "NumbercrackerwithButt", "NumberoatcakewithButt", "NumberOthbreadwithButt", "DoubleCrustPastry", "SingleCrustPastry", "Crumble", "Pizza", "Pancake", "ScotchPancake", "YorkshirePudd", "IndiaSnack", "Croissant", "DanishPastry", "Scone", "Yogurt", "Icecream", "MilkPuddin", "OthMilkPuddin", "Soya", "Fruitcake", "Cake", "Doughnut", "Spongepuddin", "Cheesecake", "Othdessert", "Chocolatebar", "WhiteChocolate", "MilkChocolate", "DarkChocolate", "ChocolateRaisin", "Chocolatesweet", "Dietsweet", "Sweets", "ChocolateCoverBiscuit", "ChocolateBiscuit", "SweetBiscuit", "CerealBar", "OthSweet", "SaltPeanut", "Peanut", "SaltNut", "Nut", "Seeds", "Crisp", "SavouryBiscuit", "CheesyBiscuit", "Olives", "OthSavoury", "InstantSoup", "CannnedSoup", "HomeSoup", "WhitePasta", "WholemealPasta", "WhiteRice", "BrownRice", "Sushi", "Snackpot", "Couscous", "OthGrain")

# Suffix for each variable
suffix <- c("_1.0", "_2.0", "_3.0", "_4.0", "_0.0")
# Loop through all variables
for (var in variables) {
  # Generate the column names for each variable
  cols <- paste0(var, suffix)
  # Check if columns exist in the dataframe
  if (all(cols %in% colnames(df))) {
    # Calculate the mean
    df[[paste0(var, "_mean")]] <- rowMeans(df[, cols], na.rm = TRUE)
  }
}
rm(cols, suffix, var, variables, bread_variables, nubread_variables, pie_variables, dessert_variables, sweet_variables, savoury_variables, soup_variables, starchy_variables, cvariables)

# merge variables
# 1. merge bread:
bread_vars <- c("SlicedBread", "Baguette", "Bap", "Breadroll", "Naanbread", "Garlicbread", "Crispbread", "Oatcakes", "Otherbread")
suffixes <- c("1.0", "2.0", "3.0", "4.0", "0.0")

# calculate bread_* variables
for(suffix in suffixes) {
  columns <- paste(bread_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("bread", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of juice
df$bread_mean <- rowMeans(df[, paste("bread", suffixes, sep="_")], na.rm = TRUE)

# Remove bread_* columns
df <- df[ , !(names(df) %in% paste("bread", suffixes, sep="_"))]
rm(columns, bread_vars, new_column, suffix)

# 2. merge bread with butt:
breadWithButt_vars <- c("NumberofsliceswithButt", "NumberbaguettewithButt", "NumberbapwithButt", "NumberbreadrollwithButt", "NumbercrackerwithButt", "NumberoatcakewithButt", "NumberOthbreadwithButt")
# calculate breadWithButt_* variables
for(suffix in suffixes) {
  columns <- paste(breadWithButt_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("breadWithButt", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of breadWithButt
df$breadWithButt_mean <- rowMeans(df[, paste("breadWithButt", suffixes, sep="_")], na.rm = TRUE)

# Remove breadWithButt_* columns
df <- df[ , !(names(df) %in% paste("breadWithButt", suffixes, sep="_"))]
rm(columns, breadWithButt_vars, new_column, suffix)

# 3. merge all bread:
breadall_vars <- c("SlicedBread", "Baguette", "Bap", "Breadroll", "Naanbread", "Garlicbread", "Crispbread", "Oatcakes", "Otherbread", "NumberofsliceswithButt", "NumberbaguettewithButt", "NumberbapwithButt", "NumberbreadrollwithButt", "NumbercrackerwithButt", "NumberoatcakewithButt", "NumberOthbreadwithButt")
# calculate breadall_* variables
for(suffix in suffixes) {
  columns <- paste(breadall_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("breadall", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of breadall
df$breadall_mean <- rowMeans(df[, paste("breadall", suffixes, sep="_")], na.rm = TRUE)

# Remove breadall_* columns
df <- df[ , !(names(df) %in% paste("breadall", suffixes, sep="_"))]
rm(columns, breadall_vars, new_column, suffix)

# 4. merge pie:
pie_vars <- c("DoubleCrustPastry", "SingleCrustPastry", "Crumble", "Pizza", "Pancake", "ScotchPancake", "YorkshirePudd", "IndiaSnack", "Croissant", "DanishPastry", "Scone")
# calculate pie_* variables
for(suffix in suffixes) {
  columns <- paste(pie_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("pie", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of pie
df$pie_mean <- rowMeans(df[, paste("pie", suffixes, sep="_")], na.rm = TRUE)

# Remove pie_* columns
df <- df[ , !(names(df) %in% paste("pie", suffixes, sep="_"))]
rm(columns, pie_vars, new_column, suffix)

# 5. merge dessert:
dessert_vars <- c("Yogurt", "Icecream", "MilkPuddin", "OthMilkPuddin", "Soya", "Fruitcake", "Cake", "Doughnut", "Spongepuddin", "Cheesecake", "Othdessert")
# calculate dessert_* variables
for(suffix in suffixes) {
  columns <- paste(dessert_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("dessert", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of dessert
df$dessert_mean <- rowMeans(df[, paste("dessert", suffixes, sep="_")], na.rm = TRUE)

# Remove dessert_* columns
df <- df[ , !(names(df) %in% paste("dessert", suffixes, sep="_"))]
rm(columns, dessert_vars, new_column, suffix)

# 6. merge sweet:
sweet_vars <- c("Chocolatebar", "WhiteChocolate", "MilkChocolate", "DarkChocolate", "ChocolateRaisin", "Chocolatesweet", "Dietsweet", "Sweets", "ChocolateCoverBiscuit", "ChocolateBiscuit", "SweetBiscuit", "CerealBar", "OthSweet")
# calculate sweet_* variables
for(suffix in suffixes) {
  columns <- paste(sweet_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("sweet", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of sweet
df$sweet_mean <- rowMeans(df[, paste("sweet", suffixes, sep="_")], na.rm = TRUE)

# Remove sweet_* columns
df <- df[ , !(names(df) %in% paste("sweet", suffixes, sep="_"))]
rm(columns, sweet_vars, new_column, suffix)

# 7. merge savoury:
savoury_vars <- c("SaltPeanut", "Peanut", "SaltNut", "Nut", "Seeds", "Crisp", "SavouryBiscuit", "CheesyBiscuit", "Olives", "OthSavoury")
# calculate savoury_* variables
for(suffix in suffixes) {
  columns <- paste(savoury_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("savoury", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of savoury
df$savoury_mean <- rowMeans(df[, paste("savoury", suffixes, sep="_")], na.rm = TRUE)

# Remove savoury_* columns
df <- df[ , !(names(df) %in% paste("savoury", suffixes, sep="_"))]
rm(columns, savoury_vars, new_column, suffix)

# 8. merge soup:
soup_vars <- c("InstantSoup", "CannnedSoup", "HomeSoup")
# calculate soup_* variables
for(suffix in suffixes) {
  columns <- paste(soup_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("soup", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of soup
df$soup_mean <- rowMeans(df[, paste("soup", suffixes, sep="_")], na.rm = TRUE)

# Remove soup_* columns
df <- df[ , !(names(df) %in% paste("soup", suffixes, sep="_"))]
rm(columns, soup_vars, new_column, suffix)

# 9. merge starchy:
starchy_vars <- c("WhitePasta", "WholemealPasta", "WhiteRice", "BrownRice", "Sushi", "Snackpot", "Couscous", "OthGrain")
# calculate starchy_* variables
for(suffix in suffixes) {
  columns <- paste(starchy_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("starchy", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of starchy
df$starchy_mean <- rowMeans(df[, paste("starchy", suffixes, sep="_")], na.rm = TRUE)

# Remove starchy_* columns
df <- df[ , !(names(df) %in% paste("starchy", suffixes, sep="_"))]
rm(columns, starchy_vars, new_column, suffix)

write.csv(df, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_grain_dessert.csv",na='',row.names=FALSE)
rm(list=ls())
```

```{r}
# get the meat vegetable data ready to go
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\food_meat_vege.csv')
# remove invalid values
# consumption variables (can be only 0 or 1)
cvariables <- c("EggConsum_1.0","EggConsum_2.0","EggConsum_3.0","EggConsum_4.0","EggConsum_0.0","MeatConsum_1.0","MeatConsum_2.0","MeatConsum_3.0","MeatConsum_4.0","MeatConsum_0.0","FishConsum_1.0","FishConsum_2.0","FishConsum_3.0","FishConsum_4.0","FishConsum_0.0","VegeAlter_1.0","VegeAlter_2.0","VegeAlter_3.0","VegeAlter_4.0","VegeAlter_0.0","SpreadConsum_1.0","SpreadConsum_2.0","SpreadConsum_3.0","SpreadConsum_4.0","SpreadConsum_0.0","NoFatCook_1.0","NoFatCook_2.0","NoFatCook_3.0","NoFatCook_4.0","NoFatCook_0.0","VegeConsum_1.0","VegeConsum_2.0","VegeConsum_3.0","VegeConsum_4.0","VegeConsum_0.0","ButterAddPotato_1.0","ButterAddPotato_2.0","ButterAddPotato_3.0","ButterAddPotato_4.0","ButterAddPotato_0.0","FruitConsum_1.0","FruitConsum_2.0","FruitConsum_3.0","FruitConsum_4.0","FruitConsum_0.0")

# wanted variables
egg_variables <- c("WholeEgg_1.0","WholeEgg_2.0","WholeEgg_3.0","WholeEgg_4.0","WholeEgg_0.0","Omelette_1.0","Omelette_2.0","Omelette_3.0","Omelette_4.0","Omelette_0.0","EgginSandwich_1.0","EgginSandwich_2.0","EgginSandwich_3.0","EgginSandwich_4.0","EgginSandwich_0.0","ScotchEgg_1.0","ScotchEgg_2.0","ScotchEgg_3.0","ScotchEgg_4.0","ScotchEgg_0.0","OthEgg_1.0","OthEgg_2.0","OthEgg_3.0","OthEgg_4.0","OthEgg_0.0")

meat_variables <- c("Sausage_1.0","Sausage_2.0","Sausage_3.0","Sausage_4.0","Sausage_0.0","Beef_1.0","Beef_2.0","Beef_3.0","Beef_4.0","Beef_0.0","Pork_1.0","Pork_2.0","Pork_3.0","Pork_4.0","Pork_0.0","Lamb_1.0","Lamb_2.0","Lamb_3.0","Lamb_4.0","Lamb_0.0","CrumbPoultry_1.0","CrumbPoultry_2.0","CrumbPoultry_3.0","CrumbPoultry_4.0","CrumbPoultry_0.0","Poultry_1.0","Poultry_2.0","Poultry_3.0","Poultry_4.0","Poultry_0.0","Bacon_1.0","Bacon_2.0","Bacon_3.0","Bacon_4.0","Bacon_0.0","Ham_1.0","Ham_2.0","Ham_3.0","Ham_4.0","Ham_0.0","Liver_1.0","Liver_2.0","Liver_3.0","Liver_4.0","Liver_0.0","OthMeat_1.0","OthMeat_2.0","OthMeat_3.0","OthMeat_4.0","OthMeat_0.0")

fish_variables <- c("TinTuna_1.0","TinTuna_2.0","TinTuna_3.0","TinTuna_4.0","TinTuna_0.0","OilyFish_1.0","OilyFish_2.0","OilyFish_3.0","OilyFish_4.0","OilyFish_0.0","BreadFish_1.0","BreadFish_2.0","BreadFish_3.0","BreadFish_4.0","BreadFish_0.0","BatteredFish_1.0","BatteredFish_2.0","BatteredFish_3.0","BatteredFish_4.0","BatteredFish_0.0","WhiteFish_1.0","WhiteFish_2.0","WhiteFish_3.0","WhiteFish_4.0","WhiteFish_0.0","Prawns_1.0","Prawns_2.0","Prawns_3.0","Prawns_4.0","Prawns_0.0","LobsterCrab_1.0","LobsterCrab_2.0","LobsterCrab_3.0","LobsterCrab_4.0","LobsterCrab_0.0","Shellfish_1.0","Shellfish_2.0","Shellfish_3.0","Shellfish_4.0","Shellfish_0.0","OthFish_1.0","OthFish_2.0","OthFish_3.0","OthFish_4.0","OthFish_0.0")

vegeAlter_variables <- c("VegeSausage_1.0","VegeSausage_2.0","VegeSausage_3.0","VegeSausage_4.0","VegeSausage_0.0","Tofu_1.0","Tofu_2.0","Tofu_3.0","Tofu_4.0","Tofu_0.0","Quorn_1.0","Quorn_2.0","Quorn_3.0","Quorn_4.0","Quorn_0.0","OthVegeAlter_1.0","OthVegeAlter_2.0","OthVegeAlter_3.0","OthVegeAlter_4.0","OthVegeAlter_0.0")

vegetable_variables <- c("BakeBean_1.0","BakeBean_2.0","BakeBean_3.0","BakeBean_4.0","BakeBean_0.0","Pulse_1.0","Pulse_2.0","Pulse_3.0","Pulse_4.0","Pulse_0.0","FriedPotato_1.0","FriedPotato_2.0","FriedPotato_3.0","FriedPotato_4.0","FriedPotato_0.0","BoilPotato_1.0","BoilPotato_2.0","BoilPotato_3.0","BoilPotato_4.0","BoilPotato_0.0","MashPotato_1.0","MashPotato_2.0","MashPotato_3.0","MashPotato_4.0","MashPotato_0.0","MixVege_1.0","MixVege_2.0","MixVege_3.0","MixVege_4.0","MixVege_0.0","VegePiece_1.0","VegePiece_2.0","VegePiece_3.0","VegePiece_4.0","VegePiece_0.0","Coleslaw_1.0","Coleslaw_2.0","Coleslaw_3.0","Coleslaw_4.0","Coleslaw_0.0","SideSalad_1.0","SideSalad_2.0","SideSalad_3.0","SideSalad_4.0","SideSalad_0.0","Avocado_1.0","Avocado_2.0","Avocado_3.0","Avocado_4.0","Avocado_0.0","BroadBean_1.0","BroadBean_2.0","BroadBean_3.0","BroadBean_4.0","BroadBean_0.0","GreenBean_1.0","GreenBean_2.0","GreenBean_3.0","GreenBean_4.0","GreenBean_0.0","Beetroot_1.0","Beetroot_2.0","Beetroot_3.0","Beetroot_4.0","Beetroot_0.0","Broccoli_1.0","Broccoli_2.0","Broccoli_3.0","Broccoli_4.0","Broccoli_0.0","Butternut_1.0","Butternut_2.0","Butternut_3.0","Butternut_4.0","Butternut_0.0","Cabbage_1.0","Cabbage_2.0","Cabbage_3.0","Cabbage_4.0","Cabbage_0.0","Carrot_1.0","Carrot_2.0","Carrot_3.0","Carrot_4.0","Carrot_0.0","Cauliflower_1.0","Cauliflower_2.0","Cauliflower_3.0","Cauliflower_4.0","Cauliflower_0.0","Celery_1.0","Celery_2.0","Celery_3.0","Celery_4.0","Celery_0.0","Courgette_1.0","Courgette_2.0","Courgette_3.0","Courgette_4.0","Courgette_0.0","Cucumber_1.0","Cucumber_2.0","Cucumber_3.0","Cucumber_4.0","Cucumber_0.0","Garlic_1.0","Garlic_2.0","Garlic_3.0","Garlic_4.0","Garlic_0.0","Leek_1.0","Leek_2.0","Leek_3.0","Leek_4.0","Leek_0.0","Lettuce_1.0","Lettuce_2.0","Lettuce_3.0","Lettuce_4.0","Lettuce_0.0","Mushroom_1.0","Mushroom_2.0","Mushroom_3.0","Mushroom_4.0","Mushroom_0.0","Onion_1.0","Onion_2.0","Onion_3.0","Onion_4.0","Onion_0.0","Parsnip_1.0","Parsnip_2.0","Parsnip_3.0","Parsnip_4.0","Parsnip_0.0","Pea_1.0","Pea_2.0","Pea_3.0","Pea_4.0","Pea_0.0","Sweetpepper_1.0","Sweetpepper_2.0","Sweetpepper_3.0","Sweetpepper_4.0","Sweetpepper_0.0","Spinach_1.0","Spinach_2.0","Spinach_3.0","Spinach_4.0","Spinach_0.0","Sprouts_1.0","Sprouts_2.0","Sprouts_3.0","Sprouts_4.0","Sprouts_0.0","Sweetcorn_1.0","Sweetcorn_2.0","Sweetcorn_3.0","Sweetcorn_4.0","Sweetcorn_0.0","Sweetpotato_1.0","Sweetpotato_2.0","Sweetpotato_3.0","Sweetpotato_4.0","Sweetpotato_0.0","FreshTomato_1.0","FreshTomato_2.0","FreshTomato_3.0","FreshTomato_4.0","FreshTomato_0.0","TinTomato_1.0","TinTomato_2.0","TinTomato_3.0","TinTomato_4.0","TinTomato_0.0","Turnip_1.0","Turnip_2.0","Turnip_3.0","Turnip_4.0","Turnip_0.0","Watercress_1.0","Watercress_2.0","Watercress_3.0","Watercress_4.0","Watercress_0.0","OthVege_1.0","OthVege_2.0","OthVege_3.0","OthVege_4.0","OthVege_0.0")

fruit_variables <- c("StewedFruit_1.0","StewedFruit_2.0","StewedFruit_3.0","StewedFruit_4.0","StewedFruit_0.0","Prune_1.0","Prune_2.0","Prune_3.0","Prune_4.0","Prune_0.0","DriedFruit_1.0","DriedFruit_2.0","DriedFruit_3.0","DriedFruit_4.0","DriedFruit_0.0","MixFruit_1.0","MixFruit_2.0","MixFruit_3.0","MixFruit_4.0","MixFruit_0.0","Apple_1.0","Apple_2.0","Apple_3.0","Apple_4.0","Apple_0.0","Banana_1.0","Banana_2.0","Banana_3.0","Banana_4.0","Banana_0.0","Berry_1.0","Berry_2.0","Berry_3.0","Berry_4.0","Berry_0.0","Cherry_1.0","Cherry_2.0","Cherry_3.0","Cherry_4.0","Cherry_0.0","Grapefruit_1.0","Grapefruit_2.0","Grapefruit_3.0","Grapefruit_4.0","Grapefruit_0.0","Grape_1.0","Grape_2.0","Grape_3.0","Grape_4.0","Grape_0.0","Mango_1.0","Mango_2.0","Mango_3.0","Mango_4.0","Mango_0.0","Melon_1.0","Melon_2.0","Melon_3.0","Melon_4.0","Melon_0.0","Orange_1.0","Orange_2.0","Orange_3.0","Orange_4.0","Orange_0.0","Satsuma_1.0","Satsuma_2.0","Satsuma_3.0","Satsuma_4.0","Satsuma_0.0","Peach_1.0","Peach_2.0","Peach_3.0","Peach_4.0","Peach_0.0","Pear_1.0","Pear_2.0","Pear_3.0","Pear_4.0","Pear_0.0","Pineapple_1.0","Pineapple_2.0","Pineapple_3.0","Pineapple_4.0","Pineapple_0.0","Plum_1.0","Plum_2.0","Plum_3.0","Plum_4.0","Plum_0.0","OthFruit_1.0","OthFruit_2.0","OthFruit_3.0","OthFruit_4.0","OthFruit_0.0")

# define valid values
valid_egg_values <- c(1, 2, 300, 555)
valid_meat_values <- c(1, 2, 3, 4, 500, 555)
valid_fish_values <- c(1, 2, 3, 400, 555)
valid_vegeAlter_values <- c(1, 2, 3, 400, 555)
valid_vegetable_values <- c(1, 2, 300, 555, 444)
valid_fruit_values <- c(1, 2, 3, 400, 555)
valid_cvalues <- c(0, 1)

# only keep valid values for wanted variables
df[, egg_variables] <- lapply(df[, egg_variables], function(x) ifelse(x %in% valid_egg_values, x, NA))
df[, meat_variables] <- lapply(df[, meat_variables], function(x) ifelse(x %in% valid_meat_values, x, NA))
df[, fish_variables] <- lapply(df[, fish_variables], function(x) ifelse(x %in% valid_fish_values, x, NA))
df[, vegeAlter_variables] <- lapply(df[, vegeAlter_variables], function(x) ifelse(x %in% valid_vegeAlter_values, x, NA))
df[, vegetable_variables] <- lapply(df[, vegetable_variables], function(x) ifelse(x %in% valid_vegetable_values, x, NA))
df[, fruit_variables] <- lapply(df[, fruit_variables], function(x) ifelse(x %in% valid_fruit_values, x, NA))
df[, cvariables] <- lapply(df[, cvariables], function(x) ifelse(x %in% valid_cvalues, x, NA))
# replace values
df[, egg_variables] <- lapply(df[, egg_variables], function(x) { 
    x <- ifelse(x == 555, 0.5, x) 
    x <- ifelse(x == 300, 3, x)
    x
})
df[, meat_variables] <- lapply(df[, meat_variables], function(x) { 
    x <- ifelse(x == 555, 0.5, x) 
    x <- ifelse(x == 500, 5, x)
    x
})
df[, fish_variables] <- lapply(df[, fish_variables], function(x) { 
    x <- ifelse(x == 555, 0.5, x) 
    x <- ifelse(x == 400, 4, x)
    x
})
df[, vegeAlter_variables] <- lapply(df[, vegeAlter_variables], function(x) { 
    x <- ifelse(x == 555, 0.5, x) 
    x <- ifelse(x == 400, 4, x)
    x
})
df[, vegetable_variables] <- lapply(df[, vegetable_variables], function(x) { 
    x <- ifelse(x == 555, 0.5, x) 
    x <- ifelse(x == 300, 3, x)
    x <- ifelse(x == 444, 0.25, x)
    x
})
df[, fruit_variables] <- lapply(df[, fruit_variables], function(x) { 
    x <- ifelse(x == 555, 0.5, x) 
    x <- ifelse(x == 400, 4, x)
    x
})

rm(valid_egg_values, valid_meat_values, valid_fish_values, valid_vegeAlter_values, valid_vegetable_values, valid_fruit_values, valid_cvalues)

# List of variables
variables <- c("WholeEgg","Omelette","EgginSandwich","ScotchEgg","OthEgg","Sausage","Beef","Pork","Lamb","CrumbPoultry","Poultry","Bacon","Ham","Liver","OthMeat","TinTuna","OilyFish","BreadFish","BatteredFish","WhiteFish","Prawns","LobsterCrab","Shellfish","OthFish","VegeSausage","Tofu","Quorn","OthVegeAlter","BakeBean","Pulse","FriedPotato","BoilPotato","MashPotato","MixVege","VegePiece","Coleslaw","SideSalad","Avocado","BroadBean","GreenBean","Beetroot","Broccoli","Butternut","Cabbage","Carrot","Cauliflower","Celery","Courgette","Cucumber","Garlic","Leek","Lettuce","Mushroom","Onion","Parsnip","Pea","Sweetpepper","Spinach","Sprouts","Sweetcorn","Sweetpotato","FreshTomato","TinTomato","Turnip","Watercress","OthVege","StewedFruit","Prune","DriedFruit","MixFruit","Apple","Banana","Berry","Cherry","Grapefruit","Grape","Mango","Melon","Orange","Satsuma","Peach","Pear","Pineapple","Plum","OthFruit")

# Suffix for each variable
suffix <- c("_1.0", "_2.0", "_3.0", "_4.0", "_0.0")
# Loop through all variables
for (var in variables) {
  # Generate the column names for each variable
  cols <- paste0(var, suffix)
  # Check if columns exist in the dataframe
  if (all(cols %in% colnames(df))) {
    # Calculate the mean
    df[[paste0(var, "_mean")]] <- rowMeans(df[, cols], na.rm = TRUE)
  }
}
rm(cols, suffix, var, variables, egg_variables,meat_variables, fish_variables, vegeAlter_variables, vegetable_variables, fruit_variables, cvariables)

# merge variables
# 1. merge egg:
egg_vars <- c("WholeEgg","Omelette","EgginSandwich","ScotchEgg","OthEgg")
suffixes <- c("1.0", "2.0", "3.0", "4.0", "0.0")

# calculate egg_* variables
for(suffix in suffixes) {
  columns <- paste(egg_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("egg", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of juice
df$egg_mean <- rowMeans(df[, paste("egg", suffixes, sep="_")], na.rm = TRUE)

# Remove bread_* columns
df <- df[ , !(names(df) %in% paste("egg", suffixes, sep="_"))]
rm(columns, egg_vars, new_column, suffix)

# 2. merge meat:
meat_vars <- c("Sausage","Beef","Pork","Lamb","CrumbPoultry","Poultry","Bacon","Ham","Liver","OthMeat")
# calculate meat_* variables
for(suffix in suffixes) {
  columns <- paste(meat_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("meat", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of meat
df$meat_mean <- rowMeans(df[, paste("meat", suffixes, sep="_")], na.rm = TRUE)

# Remove meat_* columns
df <- df[ , !(names(df) %in% paste("meat", suffixes, sep="_"))]
rm(columns, meat_vars, new_column, suffix)

# 3. merge fish:
fish_vars <- c("TinTuna","OilyFish","BreadFish","BatteredFish","WhiteFish","Prawns","LobsterCrab","Shellfish","OthFish")
# calculate fish_* variables
for(suffix in suffixes) {
  columns <- paste(fish_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("fish", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of fish
df$fish_mean <- rowMeans(df[, paste("fish", suffixes, sep="_")], na.rm = TRUE)

# Remove fish_* columns
df <- df[ , !(names(df) %in% paste("fish", suffixes, sep="_"))]
rm(columns, fish_vars, new_column, suffix)

# 4. merge vegeAlter:
vegeAlter_vars <- c("VegeSausage","Tofu","Quorn","OthVegeAlter")
# calculate vegeAlter_* variables
for(suffix in suffixes) {
  columns <- paste(vegeAlter_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("vegeAlter", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of vegeAlter
df$vegeAlter_mean <- rowMeans(df[, paste("vegeAlter", suffixes, sep="_")], na.rm = TRUE)

# Remove vegeAlter_* columns
df <- df[ , !(names(df) %in% paste("vegeAlter", suffixes, sep="_"))]
rm(columns, vegeAlter_vars, new_column, suffix)

# 5. merge vegetable:
vegetable_vars <- c("BakeBean","Pulse","FriedPotato","BoilPotato","MashPotato","MixVege","VegePiece","Coleslaw","SideSalad","Avocado","BroadBean","GreenBean","Beetroot","Broccoli","Butternut","Cabbage","Carrot","Cauliflower","Celery","Courgette","Cucumber","Garlic","Leek","Lettuce","Mushroom","Onion","Parsnip","Pea","Sweetpepper","Spinach","Sprouts","Sweetcorn","Sweetpotato","FreshTomato","TinTomato","Turnip","Watercress","OthVege")
# calculate vegetable_* variables
for(suffix in suffixes) {
  columns <- paste(vegetable_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("vegetable", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of vegetable
df$vegetable_mean <- rowMeans(df[, paste("vegetable", suffixes, sep="_")], na.rm = TRUE)

# Remove vegetable_* columns
df <- df[ , !(names(df) %in% paste("vegetable", suffixes, sep="_"))]
rm(columns, vegetable_vars, new_column, suffix)

# 6. merge fruit:
fruit_vars <- c("StewedFruit","Prune","DriedFruit","MixFruit","Apple","Banana","Berry","Cherry","Grapefruit","Grape","Mango","Melon","Orange","Satsuma","Peach","Pear","Pineapple","Plum","OthFruit")
# calculate fruit_* variables
for(suffix in suffixes) {
  columns <- paste(fruit_vars, suffix, sep="_") # creates a vector of column names with current suffix
  new_column <- paste("fruit", suffix, sep="_") # creates a name for new column
  df[[new_column]] <- rowSums(df[, columns], na.rm = TRUE)
}

# Calculate row mean of fruit
df$fruit_mean <- rowMeans(df[, paste("fruit", suffixes, sep="_")], na.rm = TRUE)

# Remove fruit_* columns
df <- df[ , !(names(df) %in% paste("fruit", suffixes, sep="_"))]
rm(columns, fruit_vars, new_column, suffix)

write.csv(df, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_meat_vege.csv",na='',row.names=FALSE)
rm(list=ls())
```



```{r}
#main effects test for liquids data
library(lmerTest)
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_liquids1.csv')
# Fit the model
df$APOE_all <- as.factor(df$APOE_all)
df$T40_Gcar <- as.factor(df$T40_Gcar)
df$family_history_AD <- as.factor(df$family_history_AD)
df$Sex <- as.factor(df$Sex)
df$AlcoholY08 <- as.factor(df$AlcoholY08)
df$SmokingY08 <- as.factor(df$SmokingY08)
df$Assessment_0 <- as.factor(df$Assessment_0)
df$EID <- as.factor(df$EID)
results <- data.frame()
# List of variables to test
test_vars <- c("Water_mean","LowCalorie_mean","Fizzy_mean","Squash_mean","OrangeJuice_mean","GrapeJuice_mean","FruitVegeJuice_mean","FruitSmoothie_mean","DairySmoothie_mean","InstantCoffee_mean","FilterCoffee_mean","Cappuccino_mean","Latte_mean","Espresso_mean","OtherCoffee_mean","LCalorieHotChocolate_mean","HChocolate_mean","juice_mean","coffee_mean")

dependent_vars <- c("rsfMRI_Component1", "rsfMRI_Component5", "rsfMRI_Component7", "rsfMRI_Component9", 
                    "rsfMRI_Component10", "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component20")

# Double loop through each dependent and test variable and fit the model
for (dep_var in dependent_vars) {
  for (test_var in test_vars) {
  
    # Construct the formula
    formula <- as.formula(paste(dep_var, "~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + 
                               BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend +", test_var, "+ 
                               (1 | Assessment_0)"))
  
    # Fit the model
    model <- lmer(formula, data = df, REML=FALSE)
    
   # Get the summary
    model_summary <- summary(model)
    
    # Extract the results for the test variable
    estimate <- model_summary$coefficients[test_var, "Estimate"]
    std_error <- model_summary$coefficients[test_var, "Std. Error"]
    p_value <- model_summary$coefficients[test_var, "Pr(>|t|)"]
    
    # Add the results to the data frame
    results <- rbind(results, data.frame(Dependent_Variable = dep_var,
                                         Test_Variable = test_var,
                                         Estimate = estimate,
                                         Std_Error = std_error,
                                         p_value = p_value))
  }
}
write.csv(results, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\output\\maineffect_liquids.csv",na='',row.names=FALSE)
rm(list=ls())

#main effects test for grain_dessert data
library(lmerTest)
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_grain_dessert.csv')
# Fit the model
df$APOE_all <- as.factor(df$APOE_all)
df$T40_Gcar <- as.factor(df$T40_Gcar)
df$family_history_AD <- as.factor(df$family_history_AD)
df$Sex <- as.factor(df$Sex)
df$AlcoholY08 <- as.factor(df$AlcoholY08)
df$SmokingY08 <- as.factor(df$SmokingY08)
df$Assessment_0 <- as.factor(df$Assessment_0)
df$EID <- as.factor(df$EID)
results <- data.frame()
# List of variables to test
test_vars <- c("SlicedBread_mean","Baguette_mean","Bap_mean","Breadroll_mean","Naanbread_mean","Garlicbread_mean","Crispbread_mean","Oatcakes_mean","Otherbread_mean","NumberofsliceswithButt_mean","NumberbaguettewithButt_mean","NumberbapwithButt_mean","NumberbreadrollwithButt_mean","NumbercrackerwithButt_mean","NumberoatcakewithButt_mean","NumberOthbreadwithButt_mean","DoubleCrustPastry_mean","SingleCrustPastry_mean","Crumble_mean","Pizza_mean","Pancake_mean","ScotchPancake_mean","YorkshirePudd_mean","IndiaSnack_mean","Croissant_mean","DanishPastry_mean","Scone_mean","Yogurt_mean","Icecream_mean","MilkPuddin_mean","OthMilkPuddin_mean","Soya_mean","Fruitcake_mean","Cake_mean","Doughnut_mean","Spongepuddin_mean","Cheesecake_mean","Othdessert_mean","Chocolatebar_mean","WhiteChocolate_mean","MilkChocolate_mean","DarkChocolate_mean","ChocolateRaisin_mean","Chocolatesweet_mean","Dietsweet_mean","Sweets_mean","ChocolateCoverBiscuit_mean","ChocolateBiscuit_mean","SweetBiscuit_mean","CerealBar_mean","OthSweet_mean","SaltPeanut_mean","Peanut_mean","SaltNut_mean","Nut_mean","Seeds_mean","Crisp_mean","SavouryBiscuit_mean","CheesyBiscuit_mean","Olives_mean","OthSavoury_mean","InstantSoup_mean","CannnedSoup_mean","HomeSoup_mean","WhitePasta_mean","WholemealPasta_mean","WhiteRice_mean","BrownRice_mean","Sushi_mean","Snackpot_mean","Couscous_mean","OthGrain_mean","bread_mean","breadWithButt_mean","breadall_mean","pie_mean","dessert_mean","sweet_mean","savoury_mean","soup_mean","starchy_mean")

dependent_vars <- c("rsfMRI_Component1", "rsfMRI_Component5", "rsfMRI_Component7", "rsfMRI_Component9", 
                    "rsfMRI_Component10", "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component20")

# Double loop through each dependent and test variable and fit the model
for (dep_var in dependent_vars) {
  for (test_var in test_vars) {
  
    # Construct the formula
    formula <- as.formula(paste(dep_var, "~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + 
                               BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend +", test_var, "+ 
                               (1 | Assessment_0)"))
  
    # Fit the model
    model <- lmer(formula, data = df, REML=FALSE)
    
   # Get the summary
    model_summary <- summary(model)
    
    # Extract the results for the test variable
    estimate <- model_summary$coefficients[test_var, "Estimate"]
    std_error <- model_summary$coefficients[test_var, "Std. Error"]
    p_value <- model_summary$coefficients[test_var, "Pr(>|t|)"]
    
    # Add the results to the data frame
    results <- rbind(results, data.frame(Dependent_Variable = dep_var,
                                         Test_Variable = test_var,
                                         Estimate = estimate,
                                         Std_Error = std_error,
                                         p_value = p_value))
  }
}
write.csv(results, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\output\\maineffect_grain_dessert.csv",na='',row.names=FALSE)
rm(list=ls())

#main effects test for food_meat_vege data
library(lmerTest)
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_meat_vege.csv')
# Fit the model
df$APOE_all <- as.factor(df$APOE_all)
df$T40_Gcar <- as.factor(df$T40_Gcar)
df$family_history_AD <- as.factor(df$family_history_AD)
df$Sex <- as.factor(df$Sex)
df$AlcoholY08 <- as.factor(df$AlcoholY08)
df$SmokingY08 <- as.factor(df$SmokingY08)
df$Assessment_0 <- as.factor(df$Assessment_0)
df$EID <- as.factor(df$EID)
results <- data.frame()
# List of variables to test
test_vars <- c("WholeEgg_mean","Omelette_mean","EgginSandwich_mean","ScotchEgg_mean","OthEgg_mean","Sausage_mean","Beef_mean","Pork_mean","Lamb_mean","CrumbPoultry_mean","Poultry_mean","Bacon_mean","Ham_mean","Liver_mean","OthMeat_mean","TinTuna_mean","OilyFish_mean","BreadFish_mean","BatteredFish_mean","WhiteFish_mean","Prawns_mean","LobsterCrab_mean","Shellfish_mean","OthFish_mean","VegeSausage_mean","Tofu_mean","Quorn_mean","OthVegeAlter_mean","BakeBean_mean","Pulse_mean","FriedPotato_mean","BoilPotato_mean","MashPotato_mean","MixVege_mean","VegePiece_mean","Coleslaw_mean","SideSalad_mean","Avocado_mean","BroadBean_mean","GreenBean_mean","Beetroot_mean","Broccoli_mean","Butternut_mean","Cabbage_mean","Carrot_mean","Cauliflower_mean","Celery_mean","Courgette_mean","Cucumber_mean","Garlic_mean","Leek_mean","Lettuce_mean","Mushroom_mean","Onion_mean","Parsnip_mean","Pea_mean","Sweetpepper_mean","Spinach_mean","Sprouts_mean","Sweetcorn_mean","Sweetpotato_mean","FreshTomato_mean","TinTomato_mean","Turnip_mean","Watercress_mean","OthVege_mean","StewedFruit_mean","Prune_mean","DriedFruit_mean","MixFruit_mean","Apple_mean","Banana_mean","Berry_mean","Cherry_mean","Grapefruit_mean","Grape_mean","Mango_mean","Melon_mean","Orange_mean","Satsuma_mean","Peach_mean","Pear_mean","Pineapple_mean","Plum_mean","OthFruit_mean","egg_mean","meat_mean","fish_mean","vegeAlter_mean","vegetable_mean","fruit_mean")

dependent_vars <- c("rsfMRI_Component1", "rsfMRI_Component5", "rsfMRI_Component7", "rsfMRI_Component9", 
                    "rsfMRI_Component10", "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component20")

# Double loop through each dependent and test variable and fit the model
for (dep_var in dependent_vars) {
  for (test_var in test_vars) {
  
    # Construct the formula
    formula <- as.formula(paste(dep_var, "~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + 
                               BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend +", test_var, "+ 
                               (1 | Assessment_0)"))
  
    # Fit the model
    model <- lmer(formula, data = df, REML=FALSE)
    
   # Get the summary
    model_summary <- summary(model)
    
    # Extract the results for the test variable
    estimate <- model_summary$coefficients[test_var, "Estimate"]
    std_error <- model_summary$coefficients[test_var, "Std. Error"]
    p_value <- model_summary$coefficients[test_var, "Pr(>|t|)"]
    
    # Add the results to the data frame
    results <- rbind(results, data.frame(Dependent_Variable = dep_var,
                                         Test_Variable = test_var,
                                         Estimate = estimate,
                                         Std_Error = std_error,
                                         p_value = p_value))
  }
}
write.csv(results, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\output\\maineffect_meat_vege.csv",na='',row.names=FALSE)
rm(list=ls())
```

```{r}
#interaction test for liquids data
library(lmerTest)
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_liquids1.csv')

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID")
for (var in factor_vars) {
  df[[var]] <- as.factor(df[[var]])
}
rm(factor_vars,var)

# Scale all continuous variables
scale_vars <- c("Water_mean","LowCalorie_mean","Fizzy_mean","Squash_mean","OrangeJuice_mean","GrapeJuice_mean","FruitVegeJuice_mean","FruitSmoothie_mean","DairySmoothie_mean","InstantCoffee_mean","FilterCoffee_mean","Cappuccino_mean","Latte_mean","Espresso_mean","OtherCoffee_mean","LCalorieHotChocolate_mean","HChocolate_mean","juice_mean","coffee_mean", "rsfMRI_Component1", "rsfMRI_Component5", "rsfMRI_Component7", "rsfMRI_Component9", "rsfMRI_Component10", "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component20", "Age_Baseline", "BMI_Y08andY12andY14_mean")

for (var in scale_vars) {
  df[[var]] <- scale(df[[var]])
}
rm(scale_vars, var)

# Define the dependent variables
dependent_vars <- c("rsfMRI_Component1", "rsfMRI_Component5", "rsfMRI_Component7", "rsfMRI_Component9", 
                    "rsfMRI_Component10", "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component20")

# List of variables to test
test_vars <- c("Water_mean","LowCalorie_mean","Fizzy_mean","Squash_mean","OrangeJuice_mean","GrapeJuice_mean","FruitVegeJuice_mean","FruitSmoothie_mean","DairySmoothie_mean","InstantCoffee_mean","FilterCoffee_mean","Cappuccino_mean","Latte_mean","Espresso_mean","OtherCoffee_mean","LCalorieHotChocolate_mean","HChocolate_mean","juice_mean","coffee_mean")

# List of factors
factor_vars <- c("APOE_all", "T40_Gcar", "family_history_AD")

# Initialize a results data frame
results <- data.frame()

# Loop over each dependent variable
for(factor_var in factor_vars) {
 for (dep_var in dependent_vars) {
  for (test_var in test_vars) {
      
    # Construct the formula
    formula <- as.formula(paste(dep_var, "~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + 
                               BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend +", factor_var, ":", test_var, "+ 
                               (1 | Assessment_0)"))
  
    # Fit the model
    model <- lmer(formula, data = df, REML=FALSE)

    # Get the summary
    model_summary <- summary(model)
   
    # Extract the results for the interaction term
    interaction_term <- paste(factor_var, test_var, sep=":")
    estimate <- model_summary$coefficients[interaction_term, "Estimate"]
    std_error <- model_summary$coefficients[interaction_term, "Std. Error"]
    p_value <- model_summary$coefficients[interaction_term, "Pr(>|t|)"]

    # Add the results to the data frame
    results <- rbind(results, data.frame(Dependent_Variable = dep_var,
                                         Factors = factor_var,
                                         Test_Variable = test_var,
                                         Estimate = estimate,
                                         Std_Error = std_error,
                                         P_Value = p_value))
    }
  }
}
write.csv(results, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\output\\interactions_liquids.csv",na='',row.names=FALSE)
rm(list=ls())

#interaction test for food_grain_dessert

df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_grain_dessert.csv')

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID")
for (var in factor_vars) {
  df[[var]] <- as.factor(df[[var]])
}
rm(factor_vars,var)

# Scale all continuous variables
scale_vars <- c("SlicedBread_mean","Baguette_mean","Bap_mean","Breadroll_mean","Naanbread_mean","Garlicbread_mean","Crispbread_mean","Oatcakes_mean","Otherbread_mean","NumberofsliceswithButt_mean","NumberbaguettewithButt_mean","NumberbapwithButt_mean","NumberbreadrollwithButt_mean","NumbercrackerwithButt_mean","NumberoatcakewithButt_mean","NumberOthbreadwithButt_mean","DoubleCrustPastry_mean","SingleCrustPastry_mean","Crumble_mean","Pizza_mean","Pancake_mean","ScotchPancake_mean","YorkshirePudd_mean","IndiaSnack_mean","Croissant_mean","DanishPastry_mean","Scone_mean","Yogurt_mean","Icecream_mean","MilkPuddin_mean","OthMilkPuddin_mean","Soya_mean","Fruitcake_mean","Cake_mean","Doughnut_mean","Spongepuddin_mean","Cheesecake_mean","Othdessert_mean","Chocolatebar_mean","WhiteChocolate_mean","MilkChocolate_mean","DarkChocolate_mean","ChocolateRaisin_mean","Chocolatesweet_mean","Dietsweet_mean","Sweets_mean","ChocolateCoverBiscuit_mean","ChocolateBiscuit_mean","SweetBiscuit_mean","CerealBar_mean","OthSweet_mean","SaltPeanut_mean","Peanut_mean","SaltNut_mean","Nut_mean","Seeds_mean","Crisp_mean","SavouryBiscuit_mean","CheesyBiscuit_mean","Olives_mean","OthSavoury_mean","InstantSoup_mean","CannnedSoup_mean","HomeSoup_mean","WhitePasta_mean","WholemealPasta_mean","WhiteRice_mean","BrownRice_mean","Sushi_mean","Snackpot_mean","Couscous_mean","OthGrain_mean","bread_mean","breadWithButt_mean","breadall_mean","pie_mean","dessert_mean","sweet_mean","savoury_mean","soup_mean","starchy_mean",               "rsfMRI_Component1", "rsfMRI_Component5", "rsfMRI_Component7", "rsfMRI_Component9", "rsfMRI_Component10", "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component20", "Age_Baseline", "BMI_Y08andY12andY14_mean")

for (var in scale_vars) {
  df[[var]] <- scale(df[[var]])
}
rm(scale_vars, var)

# Define the dependent variables
dependent_vars <- c("rsfMRI_Component1", "rsfMRI_Component5", "rsfMRI_Component7", "rsfMRI_Component9", 
                    "rsfMRI_Component10", "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component20")

# List of variables to test
test_vars <- c("SlicedBread_mean","Baguette_mean","Bap_mean","Breadroll_mean","Naanbread_mean","Garlicbread_mean","Crispbread_mean","Oatcakes_mean","Otherbread_mean","NumberofsliceswithButt_mean","NumberbaguettewithButt_mean","NumberbapwithButt_mean","NumberbreadrollwithButt_mean","NumbercrackerwithButt_mean","NumberoatcakewithButt_mean","NumberOthbreadwithButt_mean","DoubleCrustPastry_mean","SingleCrustPastry_mean","Crumble_mean","Pizza_mean","Pancake_mean","ScotchPancake_mean","YorkshirePudd_mean","IndiaSnack_mean","Croissant_mean","DanishPastry_mean","Scone_mean","Yogurt_mean","Icecream_mean","MilkPuddin_mean","OthMilkPuddin_mean","Soya_mean","Fruitcake_mean","Cake_mean","Doughnut_mean","Spongepuddin_mean","Cheesecake_mean","Othdessert_mean","Chocolatebar_mean","WhiteChocolate_mean","MilkChocolate_mean","DarkChocolate_mean","ChocolateRaisin_mean","Chocolatesweet_mean","Dietsweet_mean","Sweets_mean","ChocolateCoverBiscuit_mean","ChocolateBiscuit_mean","SweetBiscuit_mean","CerealBar_mean","OthSweet_mean","SaltPeanut_mean","Peanut_mean","SaltNut_mean","Nut_mean","Seeds_mean","Crisp_mean","SavouryBiscuit_mean","CheesyBiscuit_mean","Olives_mean","OthSavoury_mean","InstantSoup_mean","CannnedSoup_mean","HomeSoup_mean","WhitePasta_mean","WholemealPasta_mean","WhiteRice_mean","BrownRice_mean","Sushi_mean","Snackpot_mean","Couscous_mean","OthGrain_mean","bread_mean","breadWithButt_mean","breadall_mean","pie_mean","dessert_mean","sweet_mean","savoury_mean","soup_mean","starchy_mean")

# List of factors
factor_vars <- c("APOE_all", "T40_Gcar", "family_history_AD")

# Initialize a results data frame
results <- data.frame()

# Loop over each dependent variable
for(factor_var in factor_vars) {
 for (dep_var in dependent_vars) {
  for (test_var in test_vars) {
      
    # Construct the formula
    formula <- as.formula(paste(dep_var, "~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + 
                               BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend +", factor_var, ":", test_var, "+ 
                               (1 | Assessment_0)"))
  
    # Fit the model
    model <- lmer(formula, data = df, REML=FALSE)

    # Get the summary
    model_summary <- summary(model)
   
    # Extract the results for the interaction term
    interaction_term <- paste(factor_var, test_var, sep=":")
    estimate <- model_summary$coefficients[interaction_term, "Estimate"]
    std_error <- model_summary$coefficients[interaction_term, "Std. Error"]
    p_value <- model_summary$coefficients[interaction_term, "Pr(>|t|)"]

    # Add the results to the data frame
    results <- rbind(results, data.frame(Dependent_Variable = dep_var,
                                         Factors = factor_var,
                                         Test_Variable = test_var,
                                         Estimate = estimate,
                                         Std_Error = std_error,
                                         P_Value = p_value))
    }
  }
}
write.csv(results, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\output\\interactions_grain_dessert.csv",na='',row.names=FALSE)
rm(list=ls())

#interaction test for food_meat_vege

df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_meat_vege.csv')

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID")
for (var in factor_vars) {
  df[[var]] <- as.factor(df[[var]])
}
rm(factor_vars,var)

# Scale all continuous variables
scale_vars <- c("WholeEgg_mean","Omelette_mean","EgginSandwich_mean","ScotchEgg_mean","OthEgg_mean","Sausage_mean","Beef_mean","Pork_mean","Lamb_mean","CrumbPoultry_mean","Poultry_mean","Bacon_mean","Ham_mean","Liver_mean","OthMeat_mean","TinTuna_mean","OilyFish_mean","BreadFish_mean","BatteredFish_mean","WhiteFish_mean","Prawns_mean","LobsterCrab_mean","Shellfish_mean","OthFish_mean","VegeSausage_mean","Tofu_mean","Quorn_mean","OthVegeAlter_mean","BakeBean_mean","Pulse_mean","FriedPotato_mean","BoilPotato_mean","MashPotato_mean","MixVege_mean","VegePiece_mean","Coleslaw_mean","SideSalad_mean","Avocado_mean","BroadBean_mean","GreenBean_mean","Beetroot_mean","Broccoli_mean","Butternut_mean","Cabbage_mean","Carrot_mean","Cauliflower_mean","Celery_mean","Courgette_mean","Cucumber_mean","Garlic_mean","Leek_mean","Lettuce_mean","Mushroom_mean","Onion_mean","Parsnip_mean","Pea_mean","Sweetpepper_mean","Spinach_mean","Sprouts_mean","Sweetcorn_mean","Sweetpotato_mean","FreshTomato_mean","TinTomato_mean","Turnip_mean","Watercress_mean","OthVege_mean","StewedFruit_mean","Prune_mean","DriedFruit_mean","MixFruit_mean","Apple_mean","Banana_mean","Berry_mean","Cherry_mean","Grapefruit_mean","Grape_mean","Mango_mean","Melon_mean","Orange_mean","Satsuma_mean","Peach_mean","Pear_mean","Pineapple_mean","Plum_mean","OthFruit_mean","egg_mean","meat_mean","fish_mean","vegeAlter_mean","vegetable_mean","fruit_mean", "rsfMRI_Component1", "rsfMRI_Component5", "rsfMRI_Component7", "rsfMRI_Component9", "rsfMRI_Component10", "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component20", "Age_Baseline", "BMI_Y08andY12andY14_mean")

for (var in scale_vars) {
  df[[var]] <- scale(df[[var]])
}
rm(scale_vars, var)

# Define the dependent variables
dependent_vars <- c("rsfMRI_Component1", "rsfMRI_Component5", "rsfMRI_Component7", "rsfMRI_Component9", 
                    "rsfMRI_Component10", "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component20")

# List of variables to test
test_vars <- c("WholeEgg_mean","Omelette_mean","EgginSandwich_mean","ScotchEgg_mean","OthEgg_mean","Sausage_mean","Beef_mean","Pork_mean","Lamb_mean","CrumbPoultry_mean","Poultry_mean","Bacon_mean","Ham_mean","Liver_mean","OthMeat_mean","TinTuna_mean","OilyFish_mean","BreadFish_mean","BatteredFish_mean","WhiteFish_mean","Prawns_mean","LobsterCrab_mean","Shellfish_mean","OthFish_mean","VegeSausage_mean","Tofu_mean","Quorn_mean","OthVegeAlter_mean","BakeBean_mean","Pulse_mean","FriedPotato_mean","BoilPotato_mean","MashPotato_mean","MixVege_mean","VegePiece_mean","Coleslaw_mean","SideSalad_mean","Avocado_mean","BroadBean_mean","GreenBean_mean","Beetroot_mean","Broccoli_mean","Butternut_mean","Cabbage_mean","Carrot_mean","Cauliflower_mean","Celery_mean","Courgette_mean","Cucumber_mean","Garlic_mean","Leek_mean","Lettuce_mean","Mushroom_mean","Onion_mean","Parsnip_mean","Pea_mean","Sweetpepper_mean","Spinach_mean","Sprouts_mean","Sweetcorn_mean","Sweetpotato_mean","FreshTomato_mean","TinTomato_mean","Turnip_mean","Watercress_mean","OthVege_mean","StewedFruit_mean","Prune_mean","DriedFruit_mean","MixFruit_mean","Apple_mean","Banana_mean","Berry_mean","Cherry_mean","Grapefruit_mean","Grape_mean","Mango_mean","Melon_mean","Orange_mean","Satsuma_mean","Peach_mean","Pear_mean","Pineapple_mean","Plum_mean","OthFruit_mean","egg_mean","meat_mean","fish_mean","vegeAlter_mean","vegetable_mean","fruit_mean")

# List of factors
factor_vars <- c("APOE_all", "T40_Gcar", "family_history_AD")

# Initialize a results data frame
results <- data.frame()

# Loop over each dependent variable
for(factor_var in factor_vars) {
 for (dep_var in dependent_vars) {
  for (test_var in test_vars) {
      
    # Construct the formula
    formula <- as.formula(paste(dep_var, "~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + 
                               BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend +", factor_var, ":", test_var, "+ 
                               (1 | Assessment_0)"))
  
    # Fit the model
    model <- lmer(formula, data = df, REML=FALSE)

    # Get the summary
    model_summary <- summary(model)
   
    # Extract the results for the interaction term
    interaction_term <- paste(factor_var, test_var, sep=":")
    estimate <- model_summary$coefficients[interaction_term, "Estimate"]
    std_error <- model_summary$coefficients[interaction_term, "Std. Error"]
    p_value <- model_summary$coefficients[interaction_term, "Pr(>|t|)"]

    # Add the results to the data frame
    results <- rbind(results, data.frame(Dependent_Variable = dep_var,
                                         Factors = factor_var,
                                         Test_Variable = test_var,
                                         Estimate = estimate,
                                         Std_Error = std_error,
                                         P_Value = p_value))
    }
  }
}
write.csv(results, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\output\\interactions_meat_vege.csv",na='',row.names=FALSE)
rm(list=ls())
```


```{r}
# writing the continuous data paper
# 1. work on VBs, including "VB6_mean", "VB12_mean", "Folate_mean"
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_continuous.csv')
# check how many valid raws (cases) for VBs

valid_rows_subset <- complete.cases(df$AlcoholY08, df$SmokingY08, df$Assessment_0, df$EID, df$VB6_mean, df$VB12_mean, df$Folate_mean, df$rsfMRI_Component1, df$rsfMRI_Component5, df$rsfMRI_Component7, df$rsfMRI_Component9, df$rsfMRI_Component10, df$rsfMRI_Component13, df$rsfMRI_Component14, df$rsfMRI_Component20, df$Age_Baseline, df$BMI_Y08andY12andY14_mean)

sum(valid_rows_subset)
```

```{r}

# Assuming you have a vector of p-values called 'pvalues'
pvalues <- c(0.008492981, 0.012725078, 0.007010978, 0.040627048, 0.017087975, 0.368724381, 0.026959075, 0.022282602, 0.069875473, 0.078941937, 0.003931288, 0.327120803, 0.166782577, 0.011727071, 0.011243097, 0.119105235, 0.053745701, 0.620110634, 0.024457009, 0.016468914, 0.05495279, 0.620050487, 0.011019256, 0.425492283, 0.120803355, 0.626742976, 0.827005067, 0.129506062, 0.015004486, 0.121962032, 0.324096067, 0.046142867, 0.075829998, 0.939372077, 0.053734168, 0.226160564, 0.035463394, 0.007600592, 0.084871959, 0.565510846, 0.001036508, 0.348161938, 0.117926647, 0.473065421, 0.680158234, 0.267124078, 0.022393222, 0.070380033, 0.237967927, 0.021768596, 0.104700447, 0.836981531, 0.004532359, 0.1859206 ) # p-values

# Apply the Benjamini-Hochberg procedure
adjusted_pvalues <- p.adjust(pvalues, method = "BH")

# Print the adjusted p-values
print(adjusted_pvalues)

# Install Bioconductor if you haven't already
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")

# Use Bioconductor to install the qvalue package
BiocManager::install("qvalue")

# Load the qvalue package
library(qvalue)


# Calculate q-values
qvalues <- qvalue(pvalues)$qvalues

# Print the q-values
print(qvalues)


```

```{r}
#Re-do interaction test for VBs
library(lmerTest)
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_continuous.csv')

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID")
for (var in factor_vars) {
  df[[var]] <- as.factor(df[[var]])
}
rm(factor_vars,var)

# Scale all continuous variables
scale_vars <- c("VB6_mean", "VB12_mean", "Folate_mean", "Alcohol_continuous_mean", "Starch_mean", "Calcium_mean", "VE_mean", 
               "rsfMRI_Component1", "rsfMRI_Component5", "rsfMRI_Component7", "rsfMRI_Component9", "rsfMRI_Component10", 
               "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component20", "Age_Baseline", "BMI_Y08andY12andY14_mean")


for (var in scale_vars) {
  df[[var]] <- scale(df[[var]])
}
rm(scale_vars, var)

# Define the dependent variables
dependent_vars <- c("rsfMRI_Component1", "rsfMRI_Component5", "rsfMRI_Component7", "rsfMRI_Component9", 
                    "rsfMRI_Component10", "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component20")

# List of variables to test
test_vars <- c("VB6_mean", "VB12_mean", "Folate_mean")

# List of factors
factor_vars <- c("APOE_all", "T40_Gcar", "family_history_AD")

# Initialize a results data frame
results <- data.frame()

# Loop over each dependent variable
for(factor_var in factor_vars) {
 for (dep_var in dependent_vars) {
  for (test_var in test_vars) {
      
    # Construct the formula
    formula <- as.formula(paste(dep_var, "~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + 
                               BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend +",test_var,"+", factor_var, ":", test_var, "+ 
                               (1 | Assessment_0)"))
  
    # Fit the model
    model <- lmer(formula, data = df, REML=FALSE)

 # Get the summary
    model_summary <- summary(model)
   
    # Extract the results for the interaction term
    interaction_term <- paste(factor_var, test_var, sep=":")
    estimate <- model_summary$coefficients[interaction_term, "Estimate"]
    std_error <- model_summary$coefficients[interaction_term, "Std. Error"]
    p_value <- model_summary$coefficients[interaction_term, "Pr(>|t|)"]

    # Add the results to the data frame
    results <- rbind(results, data.frame(Dependent_Variable = dep_var,
                                         Factors = factor_var,
                                         Test_Variable = test_var,
                                         Estimate = estimate,
                                         Std_Error = std_error,
                                         P_Value = p_value))
    }
  }
}
write.csv(results, "C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\output\\VBs\\results\\interactions_VBs.csv",na='',row.names=FALSE)
rm(list=ls())
```

```{r}
#Re-do interaction test for significant figures
# IC1 with Folate on FH
library(lmerTest)
df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_continuous.csv')

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID")
for (var in factor_vars) {
  df[[var]] <- as.factor(df[[var]])
}
rm(factor_vars,var)

# Scale all continuous variables
scale_vars <- c("VB6_mean", "VB12_mean", "Folate_mean", "rsfMRI_Component1", "rsfMRI_Component5", "rsfMRI_Component7", "rsfMRI_Component9", "rsfMRI_Component10", "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component20", "Age_Baseline", "BMI_Y08andY12andY14_mean")


for (var in scale_vars) {
  df[[var]] <- scale(df[[var]])
}
rm(scale_vars, var)

    # Fit the model
   
model <- lmer(rsfMRI_Component1 ~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + 
                               BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend + Folate_mean + family_history_AD:Folate_mean + 
                               (1 | Assessment_0), data = df, REML=FALSE)

# Identify the rows used in the model
model_rows <- complete.cases(model.frame(model))

# Initialize a vector for predicted values
predicted_values_full <- rep(NA, nrow(df))

# Generate predicted values only for the rows used in the model
predicted_values_full[model_rows] <- predict(model, re.form = NA)

# Add the predicted values to df
df$predicted_values <- predicted_values_full

library(ggplot2)
# Assuming df is your data frame with the variables: Folate_mean, predicted values, and Family_history_AD
# Let's say the predicted values column in df is named "predicted_rsfMRI_Component1"
if (!requireNamespace("ggthemes", quietly = TRUE))
    install.packages("ggthemes")

library(ggthemes)  # for Calibri font

# Filter out rows where Family_history_AD is NA
df_filtered <- df[!is.na(df$Family_history_AD), ]

# Create the plot with the filtered data

p <- ggplot(df_filtered, aes(x = Folate_mean, y = predicted_values)) +
  geom_point(aes(color = as.factor(Family_history_AD), fill = as.factor(Family_history_AD)), shape = 21, size = 24, stroke=2) +
  geom_smooth(data = subset(df_filtered, Family_history_AD == 0), method = "lm", aes(color = as.factor(Family_history_AD)), size = 5, se = FALSE, fullrange = TRUE, color = "#56B4E9") +
  geom_smooth(data = subset(df_filtered, Family_history_AD == 1), method = "lm", aes(color = as.factor(Family_history_AD)), size = 5, se = FALSE, fullrange = TRUE, color = "#CC79A7") +
  labs(
    title = "Anterior and Posterior Default Mode Network (IC1)",
    x = "Vitamin B9 (Folate) intake",
    y = "Network Connectivity Strength (Z-score)",
    color = "APOE4 Status",  # Legend title for border color
    fill = "APOE4 Status"    # Legend title for fill color
  ) +
  scale_fill_manual(values = c("0" = "#56B4E9", "1" = "#CC79A7"), labels = c("0" = "Negative", "1" = "Positive")) +
  scale_color_manual(values = c("0" = "#0000CC", "1" = "#9900CC"), labels = c("0" = "Negative", "1" = "Positive")) +
  theme_minimal() +
  theme(
    text = element_text(size = 48, family = "Calibri"),
    axis.title = element_text(size = 60, family = "Calibri"),
    plot.title = element_text(size = 60, hjust = 0.5),
    axis.text = element_text(size = 60),  # Increase axis text size
    panel.border = element_rect(colour = "black", fill = NA, size = 10),
    axis.ticks = element_line(size = 10),
    axis.ticks.length = unit(48, "pt"),
    legend.text = element_text(size = 48),
    legend.position = c(0.8, 0.8),
    legend.background = element_blank(),
    legend.key = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank()
  )

file_path <- "C:/Users/timothy/OneDrive/Documents/ISU/food_project/output/VBs/figures/R/interaction_VB9_FH_IC1.tiff"  # Change this to your desired file path

# Save the plot to the specified location
ggsave(file_path, plot = p, width = 22.22, height = 27.78, units = "in", dpi = 72)

rm(list=ls())
```

```{r}
library(lmerTest)
library(ggplot2)
library(ggthemes)  # for Calibri font

# IC1, IC20 with Folate on FH

df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_continuous.csv')

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID", "APOE_all", "T40_Gcar", "family_history_AD")
for (var in factor_vars) {
  df[[var]] <- as.factor(df[[var]])
}
rm(factor_vars,var)

# Scale all continuous variables
scale_vars <- c("VB6_mean", "VB12_mean", "Folate_mean", "rsfMRI_Component1", "rsfMRI_Component5", "rsfMRI_Component7", "rsfMRI_Component9", "rsfMRI_Component10", "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component20", "Age_Baseline", "BMI_Y08andY12andY14_mean")


for (var in scale_vars) {
  df[[var]] <- scale(df[[var]])
}
rm(scale_vars, var)

# Define the dependent variables (including both components)
dependent_vars <- c("rsfMRI_Component1", "rsfMRI_Component20")

# Loop over each dependent variable
for (dep_var in dependent_vars) {
    # Fit the model
    formula <- as.formula(paste(dep_var, "~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend + Folate_mean + family_history_AD:Folate_mean + (1 | Assessment_0)"))
    model <- lmer(formula, data = df, REML = FALSE)

    # Generate predicted values
    model_rows <- complete.cases(model.frame(model))
    predicted_values_full <- rep(NA, nrow(df))
    predicted_values_full[model_rows] <- predict(model, re.form = NA)
    
    # Add the predicted values to df
    predicted_col_name <- paste("predicted", dep_var, sep = "_")
    df[[predicted_col_name]] <- predicted_values_full

    # Filter out rows where Family_history_AD is NA
    df_filtered <- df[!is.na(df$family_history_AD), ]

    # Determine the plot title based on the dependent variable
    if (dep_var == "rsfMRI_Component1") {
        plot_title <- "Anterior and Posterior Default Mode Network"
    } else if (dep_var == "rsfMRI_Component5") {
        plot_title <- "Left Executive Function Network"
    } else if (dep_var == "rsfMRI_Component9") {
        plot_title <- "Central Executive Function Network"
    }
    else if (dep_var == "rsfMRI_Component10") {
        plot_title <- "Affect Processing Network"
    }
    else if (dep_var == "rsfMRI_Component13") {
        plot_title <- "Right Executive Function Network"
    }
    else if (dep_var == "rsfMRI_Component14") {
        plot_title <- "Fronto-Cingular Network"
    }
    else if (dep_var == "rsfMRI_Component20") {
        plot_title <- "Posterior Default Mode Network"
    }
   
        # Create the plot for the current dependent variable
    p <- ggplot(df_filtered, aes_string(x = "Folate_mean", y = predicted_col_name)) +
      geom_point(aes(color = as.factor(family_history_AD), fill = as.factor(family_history_AD)), shape = 21, size = 24, stroke=2) +
      geom_smooth(data = subset(df_filtered, family_history_AD == 0), method = "lm", aes(color = as.factor(family_history_AD)), size = 5, se = FALSE, fullrange = TRUE, color = "#56B4E9") +
      geom_smooth(data = subset(df_filtered, family_history_AD == 1), method = "lm", aes(color = as.factor(family_history_AD)), size = 5, se = FALSE, fullrange = TRUE, color = "#CC79A7") +
      labs(
        title = plot_title,
        x = "Vitamin B9 (Folate) intake",
        y = "Network Connectivity Strength (Z-score)",
        color = "Family History Status",
        fill = "Family History Status"
      ) +
      scale_fill_manual(values = c("0" = "#56B4E9", "1" = "#CC79A7"), labels = c("0" = "Negative", "1" = "Positive")) +
      scale_color_manual(values = c("0" = "#0000CC", "1" = "#9900CC"), labels = c("0" = "Negative", "1" = "Positive")) +
      theme_minimal() +
      theme(
        text = element_text(size = 48, family = "Calibri"),
        axis.title = element_text(size = 60, family = "Calibri"),
        plot.title = element_text(size = 60, hjust = 0.5),
        axis.text = element_text(size = 60),
        panel.border = element_rect(colour = "black", fill = NA, size = 10),
        axis.ticks = element_line(size = 10),
        axis.ticks.length = unit(48, "pt"),
        legend.text = element_text(size = 48),
        legend.position = c(0.8, 0.8),
        legend.background = element_blank(),
        legend.key = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()
      )

    # Save the plot to a specified location
    file_path <- paste0("C:/Users/timothy/OneDrive/Documents/ISU/food_project/output/VBs/figures/R/interaction_VB9_FH_", dep_var, ".tiff")
    ggsave(file_path, plot = p, width = 22.22, height = 27.78, units = "in", dpi = 72)
}

# Clearing the workspace
rm(list = ls())
```




```{r}
library(lmerTest)
library(ggplot2)
library(ggthemes)  # for Calibri font

# IC1 with Folate on APOE

df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_continuous.csv')

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID")
for (var in factor_vars) {
  df[[var]] <- as.factor(df[[var]])
}
rm(factor_vars,var)

# Scale all continuous variables
scale_vars <- c("VB6_mean", "VB12_mean", "Folate_mean", "rsfMRI_Component1", "rsfMRI_Component5", "rsfMRI_Component7", "rsfMRI_Component9", "rsfMRI_Component10", "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component20", "Age_Baseline", "BMI_Y08andY12andY14_mean")


for (var in scale_vars) {
  df[[var]] <- scale(df[[var]])
}
rm(scale_vars, var)

# Define the dependent variables (including both components)
dependent_vars <- c("rsfMRI_Component1")

# Loop over each dependent variable
for (dep_var in dependent_vars) {
    # Fit the model
    formula <- as.formula(paste(dep_var, "~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend + Folate_mean + APOE_all:Folate_mean + (1 | Assessment_0)"))
    model <- lmer(formula, data = df, REML = FALSE)

    # Generate predicted values
    model_rows <- complete.cases(model.frame(model))
    predicted_values_full <- rep(NA, nrow(df))
    predicted_values_full[model_rows] <- predict(model, re.form = NA)
    
    # Add the predicted values to df
    predicted_col_name <- paste("predicted", dep_var, sep = "_")
    df[[predicted_col_name]] <- predicted_values_full

    # Filter out rows where Family_history_AD is NA
    df_filtered <- df[!is.na(df$APOE_all), ]

    # Determine the plot title based on the dependent variable
    if (dep_var == "rsfMRI_Component1") {
        plot_title <- "Anterior and Posterior Default Mode Network"
    } else if (dep_var == "rsfMRI_Component5") {
        plot_title <- "Left Executive Function Network"
    } else if (dep_var == "rsfMRI_Component9") {
        plot_title <- "Central Executive Function Network"
    }
    else if (dep_var == "rsfMRI_Component10") {
        plot_title <- "Affect Processing Network"
    }
    else if (dep_var == "rsfMRI_Component13") {
        plot_title <- "Right Executive Function Network"
    }
    else if (dep_var == "rsfMRI_Component14") {
        plot_title <- "Fronto-Cingular Network"
    }
    else if (dep_var == "rsfMRI_Component20") {
        plot_title <- "Posterior Default Mode Network"
    }
   
        # Create the plot for the current dependent variable
    p <- ggplot(df_filtered, aes_string(x = "Folate_mean", y = predicted_col_name)) +
      geom_point(aes(color = as.factor(APOE_all), fill = as.factor(APOE_all)), shape = 21, size = 24, stroke=2, data = subset(df_filtered, APOE_all %in% c(0, 1))) +
      geom_smooth(data = subset(df_filtered, APOE_all == 0), method = "lm", aes(color = as.factor(APOE_all)), size = 5, se = FALSE, fullrange = TRUE, color = "#56B4E9") +
      geom_smooth(data = subset(df_filtered, APOE_all == 1), method = "lm", aes(color = as.factor(APOE_all)), size = 5, se = FALSE, fullrange = TRUE, color = "#CC79A7") +
      labs(
        title = plot_title,
        x = "Vitamin B9 (Folate) intake",
        y = "Network Connectivity Strength (Z-score)",
        color = "APOE4 Status",
        fill = "APOE4 Status"
      ) +
      scale_fill_manual(values = c("0" = "#56B4E9", "1" = "#CC79A7"), labels = c("0" = "Negative", "1" = "Positive")) +
      scale_color_manual(values = c("0" = "#0000CC", "1" = "#9900CC"), labels = c("0" = "Negative", "1" = "Positive")) +
      theme_minimal() +
      theme(
        text = element_text(size = 48, family = "Calibri"),
        axis.title = element_text(size = 60, family = "Calibri"),
        plot.title = element_text(size = 60, hjust = 0.5),
        axis.text = element_text(size = 60),
        panel.border = element_rect(colour = "black", fill = NA, size = 10),
        axis.ticks = element_line(size = 10),
        axis.ticks.length = unit(48, "pt"),
        legend.text = element_text(size = 48),
        legend.position = c(0.8, 0.8),
        legend.background = element_blank(),
        legend.key = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()
      )

    # Save the plot to a specified location
    file_path <- paste0("C:/Users/timothy/OneDrive/Documents/ISU/food_project/output/VBs/figures/R/interaction_VB9_APOE_", dep_var, ".tiff")
    ggsave(file_path, plot = p, width = 22.22, height = 27.78, units = "in", dpi = 72)
}

# Clearing the workspace
rm(list = ls())
```
```{r}
library(lmerTest)
library(ggplot2)
library(ggthemes)  # for Calibri font

# IC1,5 with VB12 on APOE

df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_continuous.csv')

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID")
for (var in factor_vars) {
  df[[var]] <- as.factor(df[[var]])
}
rm(factor_vars,var)

# Scale all continuous variables
scale_vars <- c("VB6_mean", "VB12_mean", "Folate_mean", "rsfMRI_Component1", "rsfMRI_Component5", "rsfMRI_Component7", "rsfMRI_Component9", "rsfMRI_Component10", "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component20", "Age_Baseline", "BMI_Y08andY12andY14_mean")


for (var in scale_vars) {
  df[[var]] <- scale(df[[var]])
}
rm(scale_vars, var)

# Define the dependent variables (including both components)
dependent_vars <- c("rsfMRI_Component1", "rsfMRI_Component5")

# Loop over each dependent variable
for (dep_var in dependent_vars) {
    # Fit the model
    formula <- as.formula(paste(dep_var, "~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend + VB12_mean + APOE_all:VB12_mean + (1 | Assessment_0)"))
    model <- lmer(formula, data = df, REML = FALSE)

    # Generate predicted values
    model_rows <- complete.cases(model.frame(model))
    predicted_values_full <- rep(NA, nrow(df))
    predicted_values_full[model_rows] <- predict(model, re.form = NA)
    
    # Add the predicted values to df
    predicted_col_name <- paste("predicted", dep_var, sep = "_")
    df[[predicted_col_name]] <- predicted_values_full

    # Filter out rows where Family_history_AD is NA
    df_filtered <- df[!is.na(df$APOE_all), ]

    # Determine the plot title based on the dependent variable
    if (dep_var == "rsfMRI_Component1") {
        plot_title <- "Anterior and Posterior Default Mode Network"
    } else if (dep_var == "rsfMRI_Component5") {
        plot_title <- "Left Executive Function Network"
    } else if (dep_var == "rsfMRI_Component9") {
        plot_title <- "Central Executive Function Network"
    }
    else if (dep_var == "rsfMRI_Component10") {
        plot_title <- "Affect Processing Network"
    }
    else if (dep_var == "rsfMRI_Component13") {
        plot_title <- "Right Executive Function Network"
    }
    else if (dep_var == "rsfMRI_Component14") {
        plot_title <- "Fronto-Cingular Network"
    }
    else if (dep_var == "rsfMRI_Component20") {
        plot_title <- "Posterior Default Mode Network"
    }
   
        # Create the plot for the current dependent variable
    p <- ggplot(df_filtered, aes_string(x = "VB12_mean", y = predicted_col_name)) +
      geom_point(aes(color = as.factor(APOE_all), fill = as.factor(APOE_all)), shape = 21, size = 24, stroke=2, data = subset(df_filtered, APOE_all %in% c(0, 1))) +
      geom_smooth(data = subset(df_filtered, APOE_all == 0), method = "lm", aes(color = as.factor(APOE_all)), size = 5, se = FALSE, fullrange = TRUE, color = "#56B4E9") +
      geom_smooth(data = subset(df_filtered, APOE_all == 1), method = "lm", aes(color = as.factor(APOE_all)), size = 5, se = FALSE, fullrange = TRUE, color = "#CC79A7") +
      labs(
        title = plot_title,
        x = "Vitamin B12 (Cobalamin) intake",
        y = "Network Connectivity Strength (Z-score)",
        color = "APOE4 Status",
        fill = "APOE4 Status"
      ) +
      scale_fill_manual(values = c("0" = "#56B4E9", "1" = "#CC79A7"), labels = c("0" = "Negative", "1" = "Positive")) +
      scale_color_manual(values = c("0" = "#0000CC", "1" = "#9900CC"), labels = c("0" = "Negative", "1" = "Positive")) +
      theme_minimal() +
      theme(
        text = element_text(size = 48, family = "Calibri"),
        axis.title = element_text(size = 60, family = "Calibri"),
        plot.title = element_text(size = 60, hjust = 0.5),
        axis.text = element_text(size = 60),
        panel.border = element_rect(colour = "black", fill = NA, size = 10),
        axis.ticks = element_line(size = 10),
        axis.ticks.length = unit(48, "pt"),
        legend.text = element_text(size = 48),
        legend.position = c(0.8, 0.8),
        legend.background = element_blank(),
        legend.key = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()
      )

    # Save the plot to a specified location
    file_path <- paste0("C:/Users/timothy/OneDrive/Documents/ISU/food_project/output/VBs/figures/R/interaction_VB12_APOE_", dep_var, ".tiff")
    ggsave(file_path, plot = p, width = 22.22, height = 27.78, units = "in", dpi = 72)
}

# Clearing the workspace
rm(list = ls())
```
```{r}
library(lmerTest)
library(ggplot2)
library(ggthemes)  # for Calibri font

# IC1,5 with VB12 on APOE

df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_continuous.csv')

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID")
for (var in factor_vars) {
  df[[var]] <- as.factor(df[[var]])
}
rm(factor_vars,var)

# Scale all continuous variables
scale_vars <- c("VB6_mean", "VB12_mean", "Folate_mean", "rsfMRI_Component1", "rsfMRI_Component5", "rsfMRI_Component7", "rsfMRI_Component9", "rsfMRI_Component10", "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component20", "Age_Baseline", "BMI_Y08andY12andY14_mean")


for (var in scale_vars) {
  df[[var]] <- scale(df[[var]])
}
rm(scale_vars, var)

# Define the dependent variables (including both components)
dependent_vars <- c("rsfMRI_Component1", "rsfMRI_Component5")

# Loop over each dependent variable
for (dep_var in dependent_vars) {
    # Fit the model
    formula <- as.formula(paste(dep_var, "~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend + VB12_mean + APOE_all:VB12_mean + (1 | Assessment_0)"))
    model <- lmer(formula, data = df, REML = FALSE)

    # Generate predicted values
    model_rows <- complete.cases(model.frame(model))
    predicted_values_full <- rep(NA, nrow(df))
    predicted_values_full[model_rows] <- predict(model, re.form = NA)
    
    # Add the predicted values to df
    predicted_col_name <- paste("predicted", dep_var, sep = "_")
    df[[predicted_col_name]] <- predicted_values_full

    # Filter out rows where Family_history_AD is NA
    df_filtered <- df[!is.na(df$family_history_AD), ]

    # Determine the plot title based on the dependent variable
    if (dep_var == "rsfMRI_Component1") {
        plot_title <- "Anterior and Posterior Default Mode Network"
    } else if (dep_var == "rsfMRI_Component5") {
        plot_title <- "Left Executive Function Network"
    } else if (dep_var == "rsfMRI_Component9") {
        plot_title <- "Central Executive Function Network"
    }
    else if (dep_var == "rsfMRI_Component10") {
        plot_title <- "Affect Processing Network"
    }
    else if (dep_var == "rsfMRI_Component13") {
        plot_title <- "Right Executive Function Network"
    }
    else if (dep_var == "rsfMRI_Component14") {
        plot_title <- "Fronto-Cingular Network"
    }
    else if (dep_var == "rsfMRI_Component20") {
        plot_title <- "Posterior Default Mode Network"
    }
   
        # Create the plot for the current dependent variable
    p <- ggplot(df_filtered, aes_string(x = "VB12_mean", y = predicted_col_name)) +
      geom_point(aes(color = as.factor(APOE_all), fill = as.factor(APOE_all)), shape = 21, size = 24, stroke=2, data = subset(df_filtered, APOE_all %in% c(0, 1))) +
      geom_smooth(data = subset(df_filtered, APOE_all == 0), method = "lm", aes(color = as.factor(APOE_all)), size = 5, se = FALSE, fullrange = TRUE, color = "#56B4E9") +
      geom_smooth(data = subset(df_filtered, APOE_all == 1), method = "lm", aes(color = as.factor(APOE_all)), size = 5, se = FALSE, fullrange = TRUE, color = "#CC79A7") +
      labs(
        title = plot_title,
        x = "Vitamin B12 (Cobalamin) intake",
        y = "Network Connectivity Strength (Z-score)",
        color = "APOE4 Status",
        fill = "APOE4 Status"
      ) +
      scale_fill_manual(values = c("0" = "#56B4E9", "1" = "#CC79A7"), labels = c("0" = "Negative", "1" = "Positive")) +
      scale_color_manual(values = c("0" = "#0000CC", "1" = "#9900CC"), labels = c("0" = "Negative", "1" = "Positive")) +
      theme_minimal() +
      theme(
        text = element_text(size = 48, family = "Calibri"),
        axis.title = element_text(size = 60, family = "Calibri"),
        plot.title = element_text(size = 60, hjust = 0.5),
        axis.text = element_text(size = 60),
        panel.border = element_rect(colour = "black", fill = NA, size = 10),
        axis.ticks = element_line(size = 10),
        axis.ticks.length = unit(48, "pt"),
        legend.text = element_text(size = 48),
        legend.position = c(0.8, 0.8),
        legend.background = element_blank(),
        legend.key = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()
      )

    # Save the plot to a specified location
    file_path <- paste0("C:/Users/timothy/OneDrive/Documents/ISU/food_project/output/VBs/figures/R/interaction_VB12_APOE_", dep_var, ".tiff")
    ggsave(file_path, plot = p, width = 22.22, height = 27.78, units = "in", dpi = 72)
}

# Clearing the workspace
rm(list = ls())
```

```{r}
library(lmerTest)
library(ggplot2)
library(ggthemes)  # for Calibri font

# IC5 with VB12 on TOMM40

df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_continuous.csv')

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID")
for (var in factor_vars) {
  df[[var]] <- as.factor(df[[var]])
}
rm(factor_vars,var)

# Scale all continuous variables
scale_vars <- c("VB6_mean", "VB12_mean", "Folate_mean", "rsfMRI_Component1", "rsfMRI_Component5", "rsfMRI_Component7", "rsfMRI_Component9", "rsfMRI_Component10", "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component20", "Age_Baseline", "BMI_Y08andY12andY14_mean")


for (var in scale_vars) {
  df[[var]] <- scale(df[[var]])
}
rm(scale_vars, var)

# Define the dependent variables (including both components)
dependent_vars <- c("rsfMRI_Component5")

# Loop over each dependent variable
for (dep_var in dependent_vars) {
    # Fit the model
    formula <- as.formula(paste(dep_var, "~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend + VB12_mean + T40_Gcar:VB12_mean + (1 | Assessment_0)"))
    model <- lmer(formula, data = df, REML = FALSE)

    # Generate predicted values
    model_rows <- complete.cases(model.frame(model))
    predicted_values_full <- rep(NA, nrow(df))
    predicted_values_full[model_rows] <- predict(model, re.form = NA)
    
    # Add the predicted values to df
    predicted_col_name <- paste("predicted", dep_var, sep = "_")
    df[[predicted_col_name]] <- predicted_values_full

    # Filter out rows where Family_history_AD is NA
    df_filtered <- df[!is.na(df$family_history_AD), ]

    # Determine the plot title based on the dependent variable
    if (dep_var == "rsfMRI_Component1") {
        plot_title <- "Anterior and Posterior Default Mode Network"
    } else if (dep_var == "rsfMRI_Component5") {
        plot_title <- "Left Executive Function Network"
    } else if (dep_var == "rsfMRI_Component9") {
        plot_title <- "Central Executive Function Network"
    }
    else if (dep_var == "rsfMRI_Component10") {
        plot_title <- "Affect Processing Network"
    }
    else if (dep_var == "rsfMRI_Component13") {
        plot_title <- "Right Executive Function Network"
    }
    else if (dep_var == "rsfMRI_Component14") {
        plot_title <- "Fronto-Cingular Network"
    }
    else if (dep_var == "rsfMRI_Component20") {
        plot_title <- "Posterior Default Mode Network"
    }
   
        # Create the plot for the current dependent variable
    p <- ggplot(df_filtered, aes_string(x = "VB12_mean", y = predicted_col_name)) +
      geom_point(aes(color = as.factor(T40_Gcar), fill = as.factor(T40_Gcar)), shape = 21, size = 24, stroke=2, data = subset(df_filtered, T40_Gcar %in% c(0, 1))) +
      geom_smooth(data = subset(df_filtered, T40_Gcar == 0), method = "lm", aes(color = as.factor(T40_Gcar)), size = 5, se = FALSE, fullrange = TRUE, color = "#56B4E9") +
      geom_smooth(data = subset(df_filtered, T40_Gcar == 1), method = "lm", aes(color = as.factor(T40_Gcar)), size = 5, se = FALSE, fullrange = TRUE, color = "#CC79A7") +
      labs(
        title = plot_title,
        x = "Vitamin B12 (Cobalamin) intake",
        y = "Network Connectivity Strength (Z-score)",
        color = "TOMM40 Status",
        fill = "TOMM40 Status"
      ) +
      scale_fill_manual(values = c("0" = "#56B4E9", "1" = "#CC79A7"), labels = c("0" = "Negative", "1" = "Positive")) +
      scale_color_manual(values = c("0" = "#0000CC", "1" = "#9900CC"), labels = c("0" = "Negative", "1" = "Positive")) +
      theme_minimal() +
      theme(
        text = element_text(size = 48, family = "Calibri"),
        axis.title = element_text(size = 60, family = "Calibri"),
        plot.title = element_text(size = 60, hjust = 0.5),
        axis.text = element_text(size = 60),
        panel.border = element_rect(colour = "black", fill = NA, size = 10),
        axis.ticks = element_line(size = 10),
        axis.ticks.length = unit(48, "pt"),
        legend.text = element_text(size = 48),
        legend.position = c(0.8, 0.8),
        legend.background = element_blank(),
        legend.key = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()
      )

    # Save the plot to a specified location
    file_path <- paste0("C:/Users/timothy/OneDrive/Documents/ISU/food_project/output/VBs/figures/R/interaction_VB12_TOMM40_", dep_var, ".tiff")
    ggsave(file_path, plot = p, width = 22.22, height = 27.78, units = "in", dpi = 72)
}

# Clearing the workspace
rm(list = ls())
```

```{r}
library(lmerTest)
library(ggplot2)
library(ggthemes)  # for Calibri font

# IC1,5, 13 with VB6 on APOE

df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_continuous.csv')

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID")
for (var in factor_vars) {
  df[[var]] <- as.factor(df[[var]])
}
rm(factor_vars,var)

# Scale all continuous variables
scale_vars <- c("VB6_mean", "VB12_mean", "Folate_mean", "rsfMRI_Component1", "rsfMRI_Component5", "rsfMRI_Component7", "rsfMRI_Component9", "rsfMRI_Component10", "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component20", "Age_Baseline", "BMI_Y08andY12andY14_mean")

for (var in scale_vars) {
  df[[var]] <- scale(df[[var]])
}
rm(scale_vars, var)

# Define the dependent variables (including both components)
dependent_vars <- c("rsfMRI_Component1", "rsfMRI_Component5","rsfMRI_Component13")

# Loop over each dependent variable
for (dep_var in dependent_vars) {
    # Fit the model
    formula <- as.formula(paste(dep_var, "~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend + VB6_mean + APOE_all:VB12_mean + (1 | Assessment_0)"))
    model <- lmer(formula, data = df, REML = FALSE)

    # Generate predicted values
    model_rows <- complete.cases(model.frame(model))
    predicted_values_full <- rep(NA, nrow(df))
    predicted_values_full[model_rows] <- predict(model, re.form = NA)
    
    # Add the predicted values to df
    predicted_col_name <- paste("predicted", dep_var, sep = "_")
    df[[predicted_col_name]] <- predicted_values_full

    # Filter out rows where Family_history_AD is NA
    df_filtered <- df[!is.na(df$family_history_AD), ]

    # Determine the plot title based on the dependent variable
    if (dep_var == "rsfMRI_Component1") {
        plot_title <- "Anterior and Posterior Default Mode Network"
    } else if (dep_var == "rsfMRI_Component5") {
        plot_title <- "Left Executive Function Network"
    } else if (dep_var == "rsfMRI_Component9") {
        plot_title <- "Central Executive Function Network"
    }
    else if (dep_var == "rsfMRI_Component10") {
        plot_title <- "Affect Processing Network"
    }
    else if (dep_var == "rsfMRI_Component13") {
        plot_title <- "Right Executive Function Network"
    }
    else if (dep_var == "rsfMRI_Component14") {
        plot_title <- "Fronto-Cingular Network"
    }
    else if (dep_var == "rsfMRI_Component20") {
        plot_title <- "Posterior Default Mode Network"
    }
   
        # Create the plot for the current dependent variable
    p <- ggplot(df_filtered, aes_string(x = "VB6_mean", y = predicted_col_name)) +
      geom_point(aes(color = as.factor(APOE_all), fill = as.factor(APOE_all)), shape = 21, size = 24, stroke=2, data = subset(df_filtered, APOE_all %in% c(0, 1))) +
      geom_smooth(data = subset(df_filtered, APOE_all == 0), method = "lm", aes(color = as.factor(APOE_all)), size = 5, se = FALSE, fullrange = TRUE, color = "#56B4E9") +
      geom_smooth(data = subset(df_filtered, APOE_all == 1), method = "lm", aes(color = as.factor(APOE_all)), size = 5, se = FALSE, fullrange = TRUE, color = "#CC79A7") +
      labs(
        title = plot_title,
        x = "Vitamin B6 (Pyridoxine) intake",
        y = "Network Connectivity Strength (Z-score)",
        color = "APOE4 Status",
        fill = "APOE4 Status"
      ) +
      scale_fill_manual(values = c("0" = "#56B4E9", "1" = "#CC79A7"), labels = c("0" = "Negative", "1" = "Positive")) +
      scale_color_manual(values = c("0" = "#0000CC", "1" = "#9900CC"), labels = c("0" = "Negative", "1" = "Positive")) +
      theme_minimal() +
      theme(
        text = element_text(size = 48, family = "Calibri"),
        axis.title = element_text(size = 60, family = "Calibri"),
        plot.title = element_text(size = 60, hjust = 0.5),
        axis.text = element_text(size = 60),
        panel.border = element_rect(colour = "black", fill = NA, size = 10),
        axis.ticks = element_line(size = 10),
        axis.ticks.length = unit(48, "pt"),
        legend.text = element_text(size = 48),
        legend.position = c(0.8, 0.8),
        legend.background = element_blank(),
        legend.key = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()
      )

    # Save the plot to a specified location
    file_path <- paste0("C:/Users/timothy/OneDrive/Documents/ISU/food_project/output/VBs/figures/R/interaction_VB6_APOE_", dep_var, ".tiff")
    ggsave(file_path, plot = p, width = 22.22, height = 27.78, units = "in", dpi = 72)
}

# Clearing the workspace
rm(list = ls())
```

```{r}
library(lmerTest)
library(ggplot2)
library(ggthemes)  # for Calibri font

# IC5 with VB6 on TOMM40

df<-read.csv(file = 'C:\\Users\\timothy\\OneDrive\\Documents\\ISU\\food_project\\data\\data_for_test\\food_continuous.csv')

# Fit the model -- factor all factor variables
factor_vars <- c("AlcoholY08", "SmokingY08", "Assessment_0", "EID")
for (var in factor_vars) {
  df[[var]] <- as.factor(df[[var]])
}
rm(factor_vars,var)

# Scale all continuous variables
scale_vars <- c("VB6_mean", "VB12_mean", "Folate_mean", "rsfMRI_Component1", "rsfMRI_Component5", "rsfMRI_Component7", "rsfMRI_Component9", "rsfMRI_Component10", "rsfMRI_Component13", "rsfMRI_Component14", "rsfMRI_Component20", "Age_Baseline", "BMI_Y08andY12andY14_mean")


for (var in scale_vars) {
  df[[var]] <- scale(df[[var]])
}
rm(scale_vars, var)

# Define the dependent variables (including both components)
dependent_vars <- c("rsfMRI_Component5")

# Loop over each dependent variable
for (dep_var in dependent_vars) {
    # Fit the model
    formula <- as.formula(paste(dep_var, "~ APOE_all + T40_Gcar + family_history_AD + Age_Baseline + Sex + BMI_Y08andY12andY14_mean + AlcoholY08 + SmokingY08 + Townsend + VB6_mean + T40_Gcar:VB12_mean + (1 | Assessment_0)"))
    model <- lmer(formula, data = df, REML = FALSE)

    # Generate predicted values
    model_rows <- complete.cases(model.frame(model))
    predicted_values_full <- rep(NA, nrow(df))
    predicted_values_full[model_rows] <- predict(model, re.form = NA)
    
    # Add the predicted values to df
    predicted_col_name <- paste("predicted", dep_var, sep = "_")
    df[[predicted_col_name]] <- predicted_values_full

    # Filter out rows where Family_history_AD is NA
    df_filtered <- df[!is.na(df$family_history_AD), ]

    # Determine the plot title based on the dependent variable
    if (dep_var == "rsfMRI_Component1") {
        plot_title <- "Anterior and Posterior Default Mode Network"
    } else if (dep_var == "rsfMRI_Component5") {
        plot_title <- "Left Executive Function Network"
    } else if (dep_var == "rsfMRI_Component9") {
        plot_title <- "Central Executive Function Network"
    }
    else if (dep_var == "rsfMRI_Component10") {
        plot_title <- "Affect Processing Network"
    }
    else if (dep_var == "rsfMRI_Component13") {
        plot_title <- "Right Executive Function Network"
    }
    else if (dep_var == "rsfMRI_Component14") {
        plot_title <- "Fronto-Cingular Network"
    }
    else if (dep_var == "rsfMRI_Component20") {
        plot_title <- "Posterior Default Mode Network"
    }
   
        # Create the plot for the current dependent variable
    p <- ggplot(df_filtered, aes_string(x = "VB12_mean", y = predicted_col_name)) +
      geom_point(aes(color = as.factor(T40_Gcar), fill = as.factor(T40_Gcar)), shape = 21, size = 24, stroke=2, data = subset(df_filtered, T40_Gcar %in% c(0, 1))) +
      geom_smooth(data = subset(df_filtered, T40_Gcar == 0), method = "lm", aes(color = as.factor(T40_Gcar)), size = 5, se = FALSE, fullrange = TRUE, color = "#56B4E9") +
      geom_smooth(data = subset(df_filtered, T40_Gcar == 1), method = "lm", aes(color = as.factor(T40_Gcar)), size = 5, se = FALSE, fullrange = TRUE, color = "#CC79A7") +
      labs(
        title = plot_title,
        x = "Vitamin B12 (Cobalamin) intake",
        y = "Network Connectivity Strength (Z-score)",
        color = "TOMM40 Status",
        fill = "TOMM40 Status"
      ) +
      scale_fill_manual(values = c("0" = "#56B4E9", "1" = "#CC79A7"), labels = c("0" = "Negative", "1" = "Positive")) +
      scale_color_manual(values = c("0" = "#0000CC", "1" = "#9900CC"), labels = c("0" = "Negative", "1" = "Positive")) +
      theme_minimal() +
      theme(
        text = element_text(size = 48, family = "Calibri"),
        axis.title = element_text(size = 60, family = "Calibri"),
        plot.title = element_text(size = 60, hjust = 0.5),
        axis.text = element_text(size = 60),
        panel.border = element_rect(colour = "black", fill = NA, size = 10),
        axis.ticks = element_line(size = 10),
        axis.ticks.length = unit(48, "pt"),
        legend.text = element_text(size = 48),
        legend.position = c(0.8, 0.8),
        legend.background = element_blank(),
        legend.key = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()
      )

    # Save the plot to a specified location
    file_path <- paste0("C:/Users/timothy/OneDrive/Documents/ISU/food_project/output/VBs/figures/R/interaction_VB6_TOMM40_", dep_var, ".tiff")
    ggsave(file_path, plot = p, width = 22.22, height = 27.78, units = "in", dpi = 72)
}

# Clearing the workspace
rm(list = ls())
```